{"version":3,"names":["makeStateDataType","Constructor","name","Error","dataType","set","newVal","parent","val","type","undefined","compare","currentValue","onChange","previousVal","attributeName","stopListening","_getCachedEventBubblingHandler","listenTo","prop","test"],"sources":["make-state-datatype.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n// Reminder: any class using this function must have something like the\n// following in its initialize method:\n//\n// // HACK to deal with the fact that AmpersandState#dataTypes#set is a pure\n// // function.\n// this._dataTypes = cloneDeep(this._dataTypes);\n// Object.keys(this._dataTypes).forEach((key) => {\n//   if (this._dataTypes[key].set) {\n//     this._dataTypes[key].set = this._dataTypes[key].set.bind(this);\n//   }\n// });\n// // END HACK\n\n/**\n * Creates an ampersand state object that wires its event handlers like a an\n * ampersand child\n * @param {Function} Constructor\n * @param {string} name\n * @returns {Object}\n */\nexport default function makeStateDataType(Constructor, name) {\n  if (!Constructor || !name) {\n    throw new Error('missing parameter for makeStateDataType');\n  }\n\n  return {\n    dataType: {\n      set: function set(newVal) {\n        // newVal.parent = this;\n        if (newVal instanceof Constructor) {\n          newVal.parent = this;\n\n          return {\n            val: newVal,\n            type: name\n          };\n        }\n\n        // We only want to construct the new instance if we have some set of\n        // attributes (even an empty object) to base it on. This is to deal with\n        // the unexpected side effect that AmpState#unset will create a new\n        // instance.\n        return {\n          val: newVal ? new Constructor(newVal, {parent: this}) : undefined,\n          type: name\n        };\n      },\n      compare: function compare(currentValue, newVal) {\n        return currentValue === newVal;\n      },\n      onChange: function onChange(newVal, previousVal, attributeName) {\n        // Copied from ampersand-state.js\n        // if this has changed we want to also handle\n        // event propagation\n        if (previousVal) {\n          this.stopListening(previousVal, 'all', this._getCachedEventBubblingHandler(attributeName));\n        }\n\n        if (newVal) {\n          this.listenTo(newVal, 'all', this._getCachedEventBubblingHandler(attributeName));\n        }\n      }\n    },\n    prop: {\n      /**\n       * This is a really unfortunate hack to deal with ampersand`s decision to\n       * make the dateType#set function pure. The only function called with the\n       * scope of the parent at set time seems to be test\n       * @param {AmpersandState} newVal\n       * @returns {boolean}\n       */\n      test: function test(newVal) {\n        if (!newVal) {\n          return false;\n        }\n        newVal.parent = this;\n\n        return false;\n      },\n      type: name\n    }\n  };\n}\n"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,iBAAT,CAA2BC,WAA3B,EAAwCC,IAAxC,EAA8C;EAC3D,IAAI,CAACD,WAAD,IAAgB,CAACC,IAArB,EAA2B;IACzB,MAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;EACD;;EAED,OAAO;IACLC,QAAQ,EAAE;MACRC,GAAG,EAAE,SAASA,GAAT,CAAaC,MAAb,EAAqB;QACxB;QACA,IAAIA,MAAM,YAAYL,WAAtB,EAAmC;UACjCK,MAAM,CAACC,MAAP,GAAgB,IAAhB;UAEA,OAAO;YACLC,GAAG,EAAEF,MADA;YAELG,IAAI,EAAEP;UAFD,CAAP;QAID,CATuB,CAWxB;QACA;QACA;QACA;;;QACA,OAAO;UACLM,GAAG,EAAEF,MAAM,GAAG,IAAIL,WAAJ,CAAgBK,MAAhB,EAAwB;YAACC,MAAM,EAAE;UAAT,CAAxB,CAAH,GAA6CG,SADnD;UAELD,IAAI,EAAEP;QAFD,CAAP;MAID,CApBO;MAqBRS,OAAO,EAAE,SAASA,OAAT,CAAiBC,YAAjB,EAA+BN,MAA/B,EAAuC;QAC9C,OAAOM,YAAY,KAAKN,MAAxB;MACD,CAvBO;MAwBRO,QAAQ,EAAE,SAASA,QAAT,CAAkBP,MAAlB,EAA0BQ,WAA1B,EAAuCC,aAAvC,EAAsD;QAC9D;QACA;QACA;QACA,IAAID,WAAJ,EAAiB;UACf,KAAKE,aAAL,CAAmBF,WAAnB,EAAgC,KAAhC,EAAuC,KAAKG,8BAAL,CAAoCF,aAApC,CAAvC;QACD;;QAED,IAAIT,MAAJ,EAAY;UACV,KAAKY,QAAL,CAAcZ,MAAd,EAAsB,KAAtB,EAA6B,KAAKW,8BAAL,CAAoCF,aAApC,CAA7B;QACD;MACF;IAnCO,CADL;IAsCLI,IAAI,EAAE;MACJ;AACN;AACA;AACA;AACA;AACA;AACA;MACMC,IAAI,EAAE,SAASA,IAAT,CAAcd,MAAd,EAAsB;QAC1B,IAAI,CAACA,MAAL,EAAa;UACX,OAAO,KAAP;QACD;;QACDA,MAAM,CAACC,MAAP,GAAgB,IAAhB;QAEA,OAAO,KAAP;MACD,CAfG;MAgBJE,IAAI,EAAEP;IAhBF;EAtCD,CAAP;AAyDD"}