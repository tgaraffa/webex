{"version":3,"names":["make","containers","TopContainer","shift","data","sizes","ChildContainer","length","name","concat","map","container","join","Container","args","set","get","ret","clear","key","mine","keys","delete","next","size","undefined","overwrite","has","insert","util","inspect","depth","add","push","TypeError"],"sources":["template-container.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\n/**\n * Factory which produces a multi-keyed container based on the provided set of\n * constructors\n * @param {mixed} containers\n * @returns {Container}\n */\nfunction make(...containers) {\n  const TopContainer = containers.shift();\n\n  const data = new WeakMap();\n  const sizes = new WeakMap();\n\n  const ChildContainer = containers.length > 1 ? make(...containers) : containers[0];\n\n  const name = `(${[TopContainer.name].concat(containers.map((container) => container.name)).join(', ')})`;\n\n  /**\n   * Container that wraps an arbitrary set of tupples to their values\n   */\n  class Container {\n    /**\n     * @constructs Container\n     */\n    constructor(...args) {\n      data.set(this, new TopContainer(...args));\n      sizes.set(this, 0);\n    }\n\n    /**\n     * getter for .size\n     * @returns {number}\n     */\n    get size() {\n      return sizes.get(this);\n    }\n\n    /**\n     * Identical to Container#set() but leads slightly more intuitive code when\n     * the container is based on a Set rather than a Map.\n     * @returns {Container}\n     */\n    add(...args) {\n      return this.set(...args);\n    }\n\n    /**\n     * Removes all items from the container\n     * @returns {undefined}\n     */\n    clear() {\n      const ret = data.get(this).clear();\n\n      sizes.set(this, 0);\n\n      return ret;\n    }\n\n    /**\n     * Removes the specified item to the container\n     * @param {mixed} key\n     * @param {Array<mixed>} keys\n     * @returns {boolean}\n     */\n    delete(key, ...keys) {\n      const mine = data.get(this);\n\n      if (!keys.length) {\n        return mine.delete(key);\n      }\n\n      const next = mine.get(key);\n\n      if (!next) {\n        return false;\n      }\n\n      const ret = next.delete(...keys);\n\n      if (ret) {\n        sizes.set(this, sizes.get(this) - 1);\n      }\n\n      if (next.size === 0) {\n        mine.delete(key);\n      }\n\n      return ret;\n    }\n\n    /**\n     * Retrieves the specified item from the container\n     * @param {mixed} key\n     * @param {Array<mixed>} keys\n     * @returns {mixed}\n     */\n    get(key, ...keys) {\n      const mine = data.get(this);\n\n      if (!mine.get) {\n        return mine;\n      }\n\n      if (!keys.length) {\n        return mine.get(key);\n      }\n\n      const next = mine.get(key);\n\n      if (!next) {\n        return undefined;\n      }\n\n      if (!next.get) {\n        return next;\n      }\n\n      return next.get(...keys);\n    }\n\n    /**\n     * Indicates whether the container holds the specified item\n     * @param {mixed} key\n     * @param {Array<mixed>} keys\n     * @returns {Boolean}\n     */\n    has(...args) {\n      return typeof this.get(...args) !== 'undefined';\n    }\n\n    /**\n     * Stores the specified item in the container\n     * @param {mixed} key\n     * @param {Array<mixed>} args\n     * @param {mixed} value\n     * @returns {Container}\n     */\n    set(...args) {\n      let overwrite = false;\n\n      if (this.has(...args)) {\n        overwrite = true;\n      }\n      const mine = data.get(this);\n\n      const key = args.shift();\n\n      if (!mine.get) {\n        insert(mine, key, ...args);\n\n        return this;\n      }\n\n      let next = mine.get(key);\n\n      if (!next) {\n        if (!ChildContainer) {\n          insert(mine, key, ...args);\n\n          return this;\n        }\n        next = new ChildContainer();\n        insert(mine, key, next);\n      }\n      insert(next, ...args);\n\n      if (!overwrite) {\n        sizes.set(this, sizes.get(this) + 1);\n      }\n\n      return this;\n    }\n\n    /**\n     * @private\n     * @returns {string}\n     */\n    inspect() {\n      return `Container${name} {\n  ${util.inspect(data.get(this), {depth: null})}\n}`;\n    }\n  }\n\n  return Container;\n}\n\n/**\n * Inserts into an arbitrary container\n * @param {Map|WeakMap|Set|WeakSet} container\n * @param {Array<mixed>} args\n * @private\n * @returns {undefined}\n */\nfunction insert(container, ...args) {\n  if (container.add) {\n    container.add(...args);\n\n    return;\n  }\n\n  if (container.set) {\n    container.set(...args);\n\n    return;\n  }\n\n  if (container.push) {\n    container.push(...args);\n\n    return;\n  }\n  throw new TypeError('Could not determine how to insert into the specified container');\n}\nexport {make as default};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAIA;;AAJA;AACA;AACA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,IAAT,GAA6B;EAAA,kCAAZC,UAAY;IAAZA,UAAY;EAAA;;EAC3B,IAAMC,YAAY,GAAGD,UAAU,CAACE,KAAX,EAArB;EAEA,IAAMC,IAAI,GAAG,sBAAb;EACA,IAAMC,KAAK,GAAG,sBAAd;EAEA,IAAMC,cAAc,GAAGL,UAAU,CAACM,MAAX,GAAoB,CAApB,GAAwBP,IAAI,MAAJ,SAAQC,UAAR,CAAxB,GAA8CA,UAAU,CAAC,CAAD,CAA/E;EAEA,IAAMO,IAAI,cAAO,CAACN,YAAY,CAACM,IAAd,EAAoBC,MAApB,CAA2BR,UAAU,CAACS,GAAX,CAAe,UAACC,SAAD;IAAA,OAAeA,SAAS,CAACH,IAAzB;EAAA,CAAf,CAA3B,EAA0EI,IAA1E,CAA+E,IAA/E,CAAP,MAAV;EAEA;AACF;AACA;;EAZ6B,IAarBC,SAbqB;IAczB;AACJ;AACA;IACI,qBAAqB;MAAA;;MAAA,mCAANC,IAAM;QAANA,IAAM;MAAA;;MACnBV,IAAI,CAACW,GAAL,CAAS,IAAT,2BAAmBb,YAAnB,EAAmCY,IAAnC;MACAT,KAAK,CAACU,GAAN,CAAU,IAAV,EAAgB,CAAhB;IACD;IAED;AACJ;AACA;AACA;;;IAzB6B;MAAA;MAAA,KA0BzB,eAAW;QACT,OAAOV,KAAK,CAACW,GAAN,CAAU,IAAV,CAAP;MACD;MAED;AACJ;AACA;AACA;AACA;;IAlC6B;MAAA;MAAA,OAmCzB,eAAa;QACX,OAAO,KAAKD,GAAL,uBAAP;MACD;MAED;AACJ;AACA;AACA;;IA1C6B;MAAA;MAAA,OA2CzB,iBAAQ;QACN,IAAME,GAAG,GAAGb,IAAI,CAACY,GAAL,CAAS,IAAT,EAAeE,KAAf,EAAZ;QAEAb,KAAK,CAACU,GAAN,CAAU,IAAV,EAAgB,CAAhB;QAEA,OAAOE,GAAP;MACD;MAED;AACJ;AACA;AACA;AACA;AACA;;IAxD6B;MAAA;MAAA,OAyDzB,iBAAOE,GAAP,EAAqB;QACnB,IAAMC,IAAI,GAAGhB,IAAI,CAACY,GAAL,CAAS,IAAT,CAAb;;QADmB,mCAANK,IAAM;UAANA,IAAM;QAAA;;QAGnB,IAAI,CAACA,IAAI,CAACd,MAAV,EAAkB;UAChB,OAAOa,IAAI,CAACE,MAAL,CAAYH,GAAZ,CAAP;QACD;;QAED,IAAMI,IAAI,GAAGH,IAAI,CAACJ,GAAL,CAASG,GAAT,CAAb;;QAEA,IAAI,CAACI,IAAL,EAAW;UACT,OAAO,KAAP;QACD;;QAED,IAAMN,GAAG,GAAGM,IAAI,CAACD,MAAL,OAAAC,IAAI,EAAWF,IAAX,CAAhB;;QAEA,IAAIJ,GAAJ,EAAS;UACPZ,KAAK,CAACU,GAAN,CAAU,IAAV,EAAgBV,KAAK,CAACW,GAAN,CAAU,IAAV,IAAkB,CAAlC;QACD;;QAED,IAAIO,IAAI,CAACC,IAAL,KAAc,CAAlB,EAAqB;UACnBJ,IAAI,CAACE,MAAL,CAAYH,GAAZ;QACD;;QAED,OAAOF,GAAP;MACD;MAED;AACJ;AACA;AACA;AACA;AACA;;IAxF6B;MAAA;MAAA,OAyFzB,aAAIE,GAAJ,EAAkB;QAChB,IAAMC,IAAI,GAAGhB,IAAI,CAACY,GAAL,CAAS,IAAT,CAAb;;QAEA,IAAI,CAACI,IAAI,CAACJ,GAAV,EAAe;UACb,OAAOI,IAAP;QACD;;QALe,mCAANC,IAAM;UAANA,IAAM;QAAA;;QAOhB,IAAI,CAACA,IAAI,CAACd,MAAV,EAAkB;UAChB,OAAOa,IAAI,CAACJ,GAAL,CAASG,GAAT,CAAP;QACD;;QAED,IAAMI,IAAI,GAAGH,IAAI,CAACJ,GAAL,CAASG,GAAT,CAAb;;QAEA,IAAI,CAACI,IAAL,EAAW;UACT,OAAOE,SAAP;QACD;;QAED,IAAI,CAACF,IAAI,CAACP,GAAV,EAAe;UACb,OAAOO,IAAP;QACD;;QAED,OAAOA,IAAI,CAACP,GAAL,OAAAO,IAAI,EAAQF,IAAR,CAAX;MACD;MAED;AACJ;AACA;AACA;AACA;AACA;;IAtH6B;MAAA;MAAA,OAuHzB,eAAa;QACX,OAAO,OAAO,KAAKL,GAAL,uBAAP,KAA6B,WAApC;MACD;MAED;AACJ;AACA;AACA;AACA;AACA;AACA;;IAjI6B;MAAA;MAAA,OAkIzB,eAAa;QACX,IAAIU,SAAS,GAAG,KAAhB;;QADW,mCAANZ,IAAM;UAANA,IAAM;QAAA;;QAGX,IAAI,KAAKa,GAAL,aAAYb,IAAZ,CAAJ,EAAuB;UACrBY,SAAS,GAAG,IAAZ;QACD;;QACD,IAAMN,IAAI,GAAGhB,IAAI,CAACY,GAAL,CAAS,IAAT,CAAb;QAEA,IAAMG,GAAG,GAAGL,IAAI,CAACX,KAAL,EAAZ;;QAEA,IAAI,CAACiB,IAAI,CAACJ,GAAV,EAAe;UACbY,MAAM,MAAN,UAAOR,IAAP,EAAaD,GAAb,SAAqBL,IAArB;UAEA,OAAO,IAAP;QACD;;QAED,IAAIS,IAAI,GAAGH,IAAI,CAACJ,GAAL,CAASG,GAAT,CAAX;;QAEA,IAAI,CAACI,IAAL,EAAW;UACT,IAAI,CAACjB,cAAL,EAAqB;YACnBsB,MAAM,MAAN,UAAOR,IAAP,EAAaD,GAAb,SAAqBL,IAArB;YAEA,OAAO,IAAP;UACD;;UACDS,IAAI,GAAG,IAAIjB,cAAJ,EAAP;UACAsB,MAAM,CAACR,IAAD,EAAOD,GAAP,EAAYI,IAAZ,CAAN;QACD;;QACDK,MAAM,MAAN,UAAOL,IAAP,SAAgBT,IAAhB;;QAEA,IAAI,CAACY,SAAL,EAAgB;UACdrB,KAAK,CAACU,GAAN,CAAU,IAAV,EAAgBV,KAAK,CAACW,GAAN,CAAU,IAAV,IAAkB,CAAlC;QACD;;QAED,OAAO,IAAP;MACD;MAED;AACJ;AACA;AACA;;IAzK6B;MAAA;MAAA,OA0KzB,mBAAU;QACR,0BAAmBR,IAAnB,mBACFqB,aAAA,CAAKC,OAAL,CAAa1B,IAAI,CAACY,GAAL,CAAS,IAAT,CAAb,EAA6B;UAACe,KAAK,EAAE;QAAR,CAA7B,CADE;MAGD;IA9KwB;IAAA;EAAA;;EAiL3B,OAAOlB,SAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASe,MAAT,CAAgBjB,SAAhB,EAAoC;EAAA,mCAANG,IAAM;IAANA,IAAM;EAAA;;EAClC,IAAIH,SAAS,CAACqB,GAAd,EAAmB;IACjBrB,SAAS,CAACqB,GAAV,OAAArB,SAAS,EAAQG,IAAR,CAAT;IAEA;EACD;;EAED,IAAIH,SAAS,CAACI,GAAd,EAAmB;IACjBJ,SAAS,CAACI,GAAV,OAAAJ,SAAS,EAAQG,IAAR,CAAT;IAEA;EACD;;EAED,IAAIH,SAAS,CAACsB,IAAd,EAAoB;IAClBtB,SAAS,CAACsB,IAAV,OAAAtB,SAAS,EAASG,IAAT,CAAT;IAEA;EACD;;EACD,MAAM,IAAIoB,SAAJ,CAAc,gEAAd,CAAN;AACD"}