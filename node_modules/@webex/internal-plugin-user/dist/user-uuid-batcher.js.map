{"version":3,"names":["AbstractUserUUIDRequestBatcher","Batcher","extend","namespace","prepareItem","item","resolve","email","handleHttpSuccess","res","all","body","map","id","handleItemSuccess","handleItemFailure","response","getDeferredForResponse","then","defer","reject","fingerprintRequest","fingerprintResponse","FakeUserUUIDRequestBatcher","submitHttpRequest","payload","webex","request","method","service","resource","RealUserUUIDRequestBatcher","qs","shouldCreateUsers","UserUUIDBatcher","WebexPlugin","children","faker","creator","create"],"sources":["user-uuid-batcher.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Batcher, WebexPlugin} from '@webex/webex-core';\n\n/**\n * @class\n */\nconst AbstractUserUUIDRequestBatcher = Batcher.extend({\n  namespace: 'User',\n\n  /**\n   * @param {string} item\n   * @returns {Promise<Object>}\n   */\n  prepareItem(item) {\n    return Promise.resolve({email: item});\n  },\n\n  /**\n   * @param {HttpResponseObject} res\n   * @returns {Promise}\n   */\n  handleHttpSuccess(res) {\n    return Promise.all(Object.keys(res.body).map((email) => {\n      if (res.body[email] && res.body[email].id) {\n        return this.handleItemSuccess(email, res.body[email]);\n      }\n\n      return this.handleItemFailure(email, res.body[email]);\n    }));\n  },\n\n  handleItemFailure(email, response) {\n    return this.getDeferredForResponse(email)\n      .then((defer) => {\n        defer.reject(response);\n      });\n  },\n\n  /**\n   * @param {string} email\n   * @param {Object} response\n   * @returns {Promise}\n   */\n  handleItemSuccess(email, response) {\n    return this.getDeferredForResponse(email)\n      .then((defer) => {\n        defer.resolve(response);\n      });\n  },\n\n  /**\n   * @param {string} email\n   * @returns {Promise<string>}\n   */\n  fingerprintRequest(email) {\n    return Promise.resolve(email.email || email);\n  },\n\n  /**\n   * @param {string} email\n   * @returns {Promise<string>}\n   */\n  fingerprintResponse(email) {\n    return Promise.resolve(email);\n  }\n});\n\n/**\n * @class\n */\nconst FakeUserUUIDRequestBatcher = AbstractUserUUIDRequestBatcher.extend({\n  /**\n   * @param {Object} payload\n   * @returns {Promise<HttpResponseObject>}\n   */\n  submitHttpRequest(payload) {\n    return this.webex.request({\n      method: 'POST',\n      service: 'conversation',\n      resource: '/users',\n      body: payload\n    });\n  }\n});\n\n/**\n * @class\n */\nconst RealUserUUIDRequestBatcher = AbstractUserUUIDRequestBatcher.extend({\n  /**\n   * @param {Object} payload\n   * @returns {Promise<HttpResponseObject>}\n   */\n  submitHttpRequest(payload) {\n    return this.webex.request({\n      method: 'POST',\n      service: 'conversation',\n      resource: '/users',\n      body: payload,\n      qs: {\n        shouldCreateUsers: true\n      }\n    });\n  }\n});\n\n/**\n * @class\n */\nconst UserUUIDBatcher = WebexPlugin.extend({\n  children: {\n    faker: FakeUserUUIDRequestBatcher,\n    creator: RealUserUUIDRequestBatcher\n  },\n\n  /**\n   * @param {Object} payload\n   * @returns {Promise<Object>}\n   */\n  request(payload) {\n    return payload.create ? this.creator.request(payload.email) : this.faker.request(payload.email);\n  }\n});\n\nexport default UserUUIDBatcher;\n"],"mappings":"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"}