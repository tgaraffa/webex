{"version":3,"names":["usersByEmail","usersById","UserUUIDStore","set","user","id","reject","Error","emailAddress","patterns","uuid","test","email","p1","getById","then","u","get","catch","p2","getByEmail","all","ret","resolve"],"sources":["user-uuid-store.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {patterns} from '@webex/common';\n\nconst usersByEmail = new WeakMap();\nconst usersById = new WeakMap();\n\n/**\n * @class\n */\nexport default class UserUUIDStore {\n  /**\n   * @constructs {UserUUIDStore}\n   */\n  constructor() {\n    usersByEmail.set(this, new Map());\n    usersById.set(this, new Map());\n  }\n\n  /**\n   * Adds a user object to the store\n   * @param {Object} user\n   * @param {string} user.id\n   * @param {string} user.emailAddress\n   * @returns {Promise}\n   */\n  add(user) {\n    if (!user.id) {\n      return Promise.reject(new Error('`user.id` is required'));\n    }\n\n    if (!user.emailAddress) {\n      return Promise.reject(new Error('`user.emailAddress` is required'));\n    }\n\n    if (!patterns.uuid.test(user.id)) {\n      return Promise.reject(new Error('`user.id` does not appear to be a uuid'));\n    }\n\n    if (!patterns.email.test(user.emailAddress)) {\n      return Promise.reject(new Error('`user.emailAddress` does not appear to be an email address'));\n    }\n\n    const p1 = this.getById(user.id)\n      .then((u) => usersById.get(this).set(user.id, Object.assign({}, u, user)))\n      .catch(() => usersById.get(this).set(user.id, Object.assign({}, user)));\n\n    const p2 = this.getByEmail(user.emailAddress)\n      .then((u) => usersByEmail.get(this).set(user.emailAddress, Object.assign({}, u, user)))\n      .catch(() => usersByEmail.get(this).set(user.emailAddress, Object.assign({}, user)));\n\n    return Promise.all([p1, p2]);\n  }\n\n  /**\n   * Retrievves the specified user object from the store\n   * @param {string} id\n   * @returns {Promise<Object>}\n   */\n  get(id) {\n    if (patterns.uuid.test(id)) {\n      return this.getById(id);\n    }\n\n    if (patterns.email.test(id)) {\n      return this.getByEmail(id);\n    }\n\n    return Promise.reject(new Error('`id` does not appear to be a valid user identifier'));\n  }\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} id\n   * @returns {Promise<Object>}\n   */\n  getById(id) {\n    const ret = usersById.get(this).get(id);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified id'));\n  }\n\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} email\n   * @returns {Promise<Object>}\n   */\n  getByEmail(email) {\n    const ret = usersByEmail.get(this).get(email);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified email address'));\n  }\n}\n"],"mappings":"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"}