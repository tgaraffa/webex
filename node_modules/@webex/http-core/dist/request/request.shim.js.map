{"version":3,"names":["_request","options","resolve","params","response","setXhr","bindProgressEvents","setAuth","setCookies","setDefaults","setResponseType","setContentType","setPayload","setQs","logger","debug","method","uri","x","xhr","error","warn","statusCode","processResponseJson","headers","url","body","onprogress","download","emit","bind","catch","o","includes","toUpperCase","XMLHttpRequest","upload","auth","bearer","authorization","user","username","pass","password","token","btoa","jar","withCredentials","defs","cors","timeout","responseType","Blob","ArrayBuffer","json","detect","qs","stringify","ensureBlob","file","ret","type","filename","name","append","form","key","value","v","formData","reduce","fd","FormData","JSON","parse","e"],"sources":["request.shim.js"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\n/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\n// Note: several code paths are ignored in this file. As far as I can tell, any\n// error conditions that would provoke those paths are otherwise prevented and\n// reported.\n\nimport {defaults, isArray, pick} from 'lodash';\nimport qs from 'qs';\n\nimport xhr from '../lib/xhr';\nimport detect from '../lib/detect';\n\n/**\n * @name request\n * @param {Object} options\n * @returns {Promise}\n */\nexport default function _request(options) {\n  return new Promise((resolve) => {\n    const params = pick(options, 'method', 'uri', 'withCredentials', 'headers', 'timeout', 'responseType');\n\n    // Set `response` to `true` to approximate an `HttpResponse` object\n    params.response = true;\n\n    setXhr(params);\n    bindProgressEvents(params, options);\n    setAuth(params, options);\n    setCookies(params, options);\n    setDefaults(params, options);\n    setResponseType(params, options);\n    setContentType(params, options);\n    setPayload(params, options);\n    setQs(params, options);\n\n    options.logger.debug(`start http ${options.method ? options.method : 'request'} to ${options.uri}`);\n\n    const x = xhr(params, (error, response) => {\n      /* istanbul ignore next */\n      if (error) {\n        options.logger.warn(error);\n      }\n\n      /* istanbul ignore else */\n      if (response) {\n        if (response.statusCode >= 400) {\n          options.logger.warn(`http ${options.method ? options.method : 'request'} to ${options.uri} result: ${response.statusCode}`);\n        }\n        else {\n          options.logger.debug(`http ${options.method ? options.method : 'request'} to ${options.uri} result: ${response.statusCode}`);\n        }\n        response.options = options;\n        processResponseJson(response, params);\n        resolve(response);\n      }\n      else {\n        resolve({\n          statusCode: 0,\n          options,\n          headers: options.headers,\n          method: options.method,\n          url: options.uri,\n          body: error\n        });\n      }\n    });\n\n    x.onprogress = options.download.emit.bind(options.download, 'progress');\n  })\n    .catch((error) => {\n      options.logger.warn(error);\n\n      /* eslint arrow-body-style: [0] */\n      /* istanbul ignore next */\n      return {\n        statusCode: 0,\n        options,\n        headers: options.headers,\n        method: options.method,\n        url: options.uri,\n        body: error\n      };\n    });\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function bindProgressEvents(params, o) {\n    if (params.method && ['PATCH', 'POST', 'PUT'].includes(params.method.toUpperCase())) {\n      if (!params.xhr) {\n        params.xhr = new XMLHttpRequest();\n      }\n      params.xhr.upload.onprogress = o.upload.emit.bind(o.upload, 'progress');\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setXhr(params) {\n    params.xhr = new XMLHttpRequest();\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setAuth(params, o) {\n    if (o.auth) {\n      if (o.auth.bearer) {\n        params.headers.authorization = `Bearer ${o.auth.bearer}`;\n      }\n      else {\n        const user = o.auth.user || o.auth.username;\n        const pass = o.auth.pass || o.auth.password;\n\n        const token = btoa(`${user}:${pass}`);\n\n        params.headers.authorization = `Basic ${token}`;\n      }\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setCookies(params, o) {\n    if (o.jar) {\n      params.withCredentials = true;\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setDefaults(params, o) {\n    const defs = {\n      cors: true,\n      // raynos/xhr defaults withCredentials to true if cors is true, so we need\n      // to make it explicitly false by default\n      withCredentials: false,\n      timeout: 0\n    };\n\n    defaults(params, pick(o, Object.keys(defs)), defs);\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setResponseType(params, o) {\n    if (o.responseType === 'buffer') {\n      params.responseType = 'arraybuffer';\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  async function setContentType(params, o) {\n    if (o.body instanceof Blob || o.body instanceof ArrayBuffer) {\n      o.json = params.json = false;\n      params.headers['content-type'] = params.headers['content-type'] || await detect(o.body);\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setQs(params, o) {\n    if (o.qs) {\n      params.uri += `?${qs.stringify(o.qs)}`;\n    }\n  }\n\n  /**\n   * Converts arraybuffers to blobs before uploading them\n   * @param {mixed} file\n   * @private\n   * @returns {mixed}\n   */\n  function ensureBlob(file) {\n    if (file instanceof ArrayBuffer) {\n      const ret = file.type ? new Blob([file], {type: file.type}) : new Blob([file]);\n\n      ret.filename = file.filename || file.name || 'untitled';\n\n      return ret;\n    }\n\n    return file;\n  }\n\n  /**\n   * Appends an item to a form\n   * @param {FormData} form\n   * @param {string} key\n   * @param {mixed} value\n   * @returns {undefined}\n   */\n  function append(form, key, value) {\n    if (isArray(value)) {\n      for (const v of value) {\n        append(form, key, v);\n      }\n\n      return;\n    }\n\n    value = ensureBlob(value);\n    if (value.name) {\n      value.filename = value.name;\n      form.append(key, value, value.name);\n    }\n    else {\n      form.append(key, value);\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setPayload(params, o) {\n    if ((!('json' in o) || o.json === true) && o.body) {\n      params.json = o.body;\n    }\n    else if (o.form) {\n      params.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n      params.body = qs.stringify(o.form);\n      Reflect.deleteProperty(params, 'json');\n    }\n    else if (o.formData) {\n      params.body = Object.keys(o.formData).reduce((fd, key) => {\n        const value = o.formData[key];\n\n        append(fd, key, value);\n\n        return fd;\n      }, new FormData());\n    }\n    else {\n      params.body = o.body;\n      Reflect.deleteProperty(params, 'json');\n    }\n  }\n\n  /**\n   * @param {Object} response\n   * @param {Object} params\n   * @private\n   * @returns {undefined}\n   */\n  function processResponseJson(response, params) {\n    // If params.json is not defined, xhr won't deserialize the response\n    // so we should give it a shot just in case.\n    if (!params.json && typeof response.body !== 'object') {\n      try {\n        response.body = JSON.parse(response.body);\n      }\n      catch (e) {\n        /* eslint no-empty: [0] */\n      }\n    }\n  }\n}\n"],"mappings":"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"}