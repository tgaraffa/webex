{"version":3,"names":["registerInternalPlugin","Conversation","payloadTransformer","predicates","name","test","ctx","optionsOrResponse","resolve","extract","body","direction","event","activity","response","multistatus","map","item","data","options","items","transforms","fn","array","all","transform","then","decrypt","object","objectType","content","webex","config","conversation","inboundProcessFunc","allowedInboundTags","allowedInboundStyles","htmlFilter","c","outboundProcessFunc","allowedOutboundTags","allowedOutboundStyles","htmlFilterEscape","activities","participants","actor","target","threadActivity","childActivities","person","email","entryEmail","emailAddress","id","entryUUID","patterns","toLowerCase","roomProperties","isModerator","Boolean","uuid","reject","Error","internal","user","asUUID","concat","decryptionTransforms","encryptionTransforms"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport '@webex/internal-plugin-encryption';\nimport '@webex/internal-plugin-user';\n\nimport {patterns} from '@webex/common';\nimport {filter as htmlFilter, filterEscape as htmlFilterEscape} from '@webex/helper-html';\nimport {registerInternalPlugin} from '@webex/webex-core';\nimport {capitalize, get, has} from 'lodash';\n\nimport Conversation from './conversation';\nimport config from './config';\nimport {transforms as encryptionTransforms} from './encryption-transforms';\nimport {transforms as decryptionTransforms} from './decryption-transforms';\n\nregisterInternalPlugin('conversation', Conversation, {\n  payloadTransformer: {\n    predicates: [\n      {\n        name: 'transformObject',\n        test(ctx, optionsOrResponse) {\n          return Promise.resolve(has(optionsOrResponse, 'body.objectType'));\n        },\n        extract(optionsOrResponse) {\n          return Promise.resolve(optionsOrResponse.body);\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'inbound',\n        test(ctx, event) {\n          return Promise.resolve(has(event, 'activity'));\n        },\n        extract(event) {\n          return Promise.resolve(event.activity);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.multistatus'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body.multistatus.map((item) => item && item.data && item.data.activity));\n        }\n      },\n      {\n        name: 'normalizeConversationListAndBindDecrypters',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].objectType')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(true);\n          }\n\n          return Promise.resolve(false);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].objectType')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(false);\n          }\n\n          return Promise.resolve(true);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      },\n      {\n        name: 'transformThreadArray',\n        direction: 'inbound',\n        test(ctx, options) {\n          if (!has(options, 'body.items[0].childType') || !has(options, 'body.items[0].actorId')) {\n            return Promise.resolve(false);\n          }\n\n          if (get(options, 'options.deferDecrypt')) {\n            return Promise.resolve(false);\n          }\n\n          return Promise.resolve(true);\n        },\n        extract(options) {\n          return Promise.resolve(options.body.items);\n        }\n      }\n    ],\n    transforms: [\n      {\n        name: 'normalizeConversationListAndBindDecrypters',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('normalizeObject', item)\n            .then(() => {\n              item.decrypt = function decrypt() {\n                Reflect.deleteProperty(item, 'decrypt');\n\n                return ctx.transform('decryptObject', item);\n              };\n\n              return item;\n            })));\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('transformObject', item)));\n        }\n      },\n      {\n        name: 'transformThreadArray',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('transformThread', item)));\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'outbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('normalizeObject', object)\n            .then(() => ctx.transform('encryptObject', object))\n            .then(() => ctx.transform('encryptKmsMessage', object));\n        }\n      },\n      {\n        name: 'transformObject',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('decryptObject', object)\n            .then(() => ctx.transform('normalizeObject', object));\n        }\n      },\n      {\n        name: 'normalizeObject',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.objectType) {\n            return Promise.resolve();\n          }\n\n          return Promise.all([\n            ctx.transform(`normalize${capitalize(object.objectType)}`, object),\n            ctx.transform('normalizePropContent', object)\n          ]);\n        }\n      },\n      {\n        name: 'transformThread',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          return ctx.transform('decryptThread', object)\n            .then(() => ctx.transform('normalizeThread', object));\n        }\n      },\n      {\n        name: 'normalizePropContent',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object.content) {\n            return Promise.resolve();\n          }\n          const {\n            inboundProcessFunc,\n            allowedInboundTags,\n            allowedInboundStyles\n          } = ctx.webex.config.conversation;\n\n          return htmlFilter(inboundProcessFunc, allowedInboundTags || {}, allowedInboundStyles, object.content)\n            .then((c) => {\n              object.content = c;\n            });\n        }\n      },\n      {\n        name: 'normalizePropContent',\n        direction: 'outbound',\n        fn(ctx, object) {\n          if (!object.content) {\n            return Promise.resolve();\n          }\n\n          const {\n            outboundProcessFunc,\n            allowedOutboundTags,\n            allowedOutboundStyles\n          } = ctx.webex.config.conversation;\n\n          return htmlFilterEscape(outboundProcessFunc, allowedOutboundTags || {}, allowedOutboundStyles, object.content)\n            .then((c) => {\n              object.content = c;\n            });\n        }\n      },\n      {\n        name: 'normalizeConversation',\n        fn(ctx, conversation) {\n          conversation.activities = conversation.activities || {};\n          conversation.activities.items = conversation.activities.items || [];\n          conversation.participants = conversation.participants || {};\n          conversation.participants.items = conversation.participants.items || [];\n\n          return Promise.all([\n            Promise.all(conversation.activities.items.map((item) => ctx.transform('normalizeObject', item))),\n            Promise.all(conversation.participants.items.map((item) => ctx.transform('normalizeObject', item)))\n          ]);\n        }\n      },\n      {\n        name: 'normalizeActivity',\n        fn(ctx, activity) {\n          return Promise.all([\n            ctx.transform('normalizeObject', activity.actor),\n            ctx.transform('normalizeObject', activity.object),\n            ctx.transform('normalizeObject', activity.target)\n          ]);\n        }\n      },\n      {\n        name: 'normalizeThread',\n        fn(ctx, threadActivity) {\n          // childActivities are of type Activity\n          return Promise.all(threadActivity.childActivities.map((item) => ctx.transform('normalizeObject', item)));\n        }\n      },\n      {\n        name: 'normalizePerson',\n        // eslint-disable-next-line complexity\n        fn(ctx, person) {\n          const email = person.entryEmail || person.emailAddress || person.id;\n          const id = person.entryUUID || person.id;\n\n          if (patterns.email.test(email)) {\n            person.entryEmail = person.emailAddress = email.toLowerCase();\n          }\n          else {\n            Reflect.deleteProperty(person, 'entryEmail');\n            Reflect.deleteProperty(person, 'emailAddress');\n          }\n\n          if (person.roomProperties) {\n            person.roomProperties.isModerator = Boolean(person.roomProperties.isModerator);\n          }\n\n          if (patterns.uuid.test(id)) {\n            person.entryUUID = person.id = id.toLowerCase();\n\n            return Promise.resolve(person);\n          }\n\n          if (!email) {\n            return Promise.reject(new Error('cannot determine id without an `emailAddress` or `entryUUID` property'));\n          }\n\n          return ctx.webex.internal.user.asUUID(email)\n            .then((uuid) => {\n              person.entryUUID = person.id = uuid;\n\n              return person;\n            });\n        }\n      }\n    ]\n      .concat(decryptionTransforms)\n      .concat(encryptionTransforms)\n  },\n  config\n});\n\nexport {default} from './conversation';\nexport {default as ShareActivity} from './share-activity';\nexport {ConversationError, InvalidUserCreation} from './convo-error';\n"],"mappings":"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"}