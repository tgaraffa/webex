{"version":3,"names":["OLDER","NEWER","MID","INITIAL","ACTIVITY_TYPES","REPLY","EDIT","REACTION","REACTION_SELF","ROOT","CREATE","TOMBSTONE","DELETE","REPLY_EDIT","REACTION_SUMMARY","REACTION_SELF_SUMMARY","ADD","getActivityType","activity","parent","type","verb","getPublishedDate","Date","published","getTime","isNewer","activity1","activity2","sortActivitiesByPublishedDate","activities","getParentId","id","isRootActivity","act","isReplyActivity","isEditActivity","isCreateActivity","isDeleteActivity","sanitizeActivity","final","reaction","reactionSelf","replies","getIsActivityOrphaned","getIsReplyEditActivity","parentId","parentActivity","determineActivityType","initialType","isReplyEditActivity","createRootActivity","createReplyActivity","replyAct","replyParent","createEditActivity","editActivity","editActParentObj","parentAct","joinedEditAct","editParent","object","createReplyEditActivity","parentReplyAct","joinedReplyEditActivity"],"sources":["activities.js"],"sourcesContent":["import {sortBy} from 'lodash';\n\nexport const OLDER = 'older';\nexport const NEWER = 'newer';\nexport const MID = 'mid';\nexport const INITIAL = 'initial';\n\nexport const ACTIVITY_TYPES = {\n  REPLY: 'REPLY',\n  EDIT: 'EDIT',\n  REACTION: 'REACTION',\n  REACTION_SELF: 'REACTION_SELF',\n  ROOT: 'ROOT',\n  CREATE: 'CREATE',\n  TOMBSTONE: 'TOMBSTONE',\n  DELETE: 'DELETE',\n  REPLY_EDIT: 'REPLY_EDIT'\n};\n\nconst REPLY = 'reply';\nconst EDIT = 'edit';\nconst REACTION_SUMMARY = 'reactionSummary';\nconst REACTION_SELF_SUMMARY = 'reactionSelfSummary';\nconst CREATE = 'create';\nconst TOMBSTONE = 'tombstone';\nconst DELETE = 'delete';\nconst ADD = 'add';\n\nexport const getActivityType = (activity) => {\n  if (activity.parent?.type === REPLY) {\n    return ACTIVITY_TYPES.REPLY;\n  }\n  if (activity.parent?.type === EDIT) {\n    return ACTIVITY_TYPES.EDIT;\n  }\n  if (activity.verb === ADD || activity.type === REACTION_SUMMARY) {\n    return ACTIVITY_TYPES.REACTION;\n  }\n  if (activity.type === REACTION_SELF_SUMMARY) {\n    return ACTIVITY_TYPES.REACTION_SELF;\n  }\n  if (activity.verb === CREATE) {\n    return ACTIVITY_TYPES.CREATE;\n  }\n  if (activity.verb === TOMBSTONE) {\n    return ACTIVITY_TYPES.TOMBSTONE;\n  }\n  if (activity.verb === DELETE) {\n    return ACTIVITY_TYPES.DELETE;\n  }\n\n  return ACTIVITY_TYPES.ROOT;\n};\n\nexport const getPublishedDate = (activity = {}) => new Date(activity.published).getTime();\n\n/**\n * @param {Object} activity1\n * @param {Object} activity2\n * @returns {boolean} true if first activity is newer than second\n */\nexport const isNewer = (activity1, activity2) => getPublishedDate(activity1) > getPublishedDate(activity2);\n\nexport const sortActivitiesByPublishedDate = (activities) => sortBy(activities, (activity) => getPublishedDate(activity));\n\nexport const getParentId = (activity) => activity?.parent?.id;\n\nexport const isRootActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.ROOT;\nexport const isReplyActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.REPLY;\nexport const isEditActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.EDIT;\nexport const isCreateActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.CREATE;\nexport const isDeleteActivity = (act) => getActivityType(act) === ACTIVITY_TYPES.DELETE;\n\nexport const sanitizeActivity = (activity) => {\n  const final = {...activity};\n\n  final.reaction = activity.reaction || {};\n  final.reactionSelf = activity.reactionSelf || {};\n\n  // replies will be spread in order beneath parent, no need to include on final objects\n  delete final.replies;\n\n  return final;\n};\n\nexport const getIsActivityOrphaned = (activity, activities) => activity.parent && activity.parent.id && !activities[activity.parent.id];\n\nconst getIsReplyEditActivity = (activity, activities) => {\n  const parentId = activity.parent.id;\n  const parentActivity = activities[parentId];\n\n  return parentActivity && isReplyActivity(parentActivity);\n};\n\nexport const determineActivityType = (activity, activities) => {\n  const initialType = getActivityType(activity);\n\n  // edits to a reply, while they are replies themselves, appear in every way as edits\n  // the only way to dermine their status as an edited reply is to find the original reply\n  if (initialType === ACTIVITY_TYPES.EDIT) {\n    const isReplyEditActivity = getIsReplyEditActivity(activity, activities);\n\n    return isReplyEditActivity ? ACTIVITY_TYPES.REPLY_EDIT : initialType;\n  }\n\n  return initialType;\n};\n\nexport const createRootActivity = (activity) => activity;\n\nexport const createReplyActivity = (activity) => {\n  const replyAct = {\n    ...activity,\n    replyParent: activity.parent\n  };\n\n  return replyAct;\n};\n\nexport const createEditActivity = (editActivity, activities) => {\n  const editActParentObj = editActivity.parent;\n  const parentId = editActParentObj.id;\n  const parentAct = activities[parentId];\n\n  const joinedEditAct = {\n    ...parentAct,\n    id: editActivity.id,\n    parent: editActParentObj,\n    editParent: editActParentObj,\n    object: editActivity.object,\n    published: editActivity.published\n  };\n\n  return joinedEditAct;\n};\n\n// takes an edit activity whose parent is a reply activity\nexport const createReplyEditActivity = (editActivity, activities) => {\n  const editActParentObj = editActivity.parent;\n  const parentId = editActParentObj.id;\n  const parentReplyAct = activities[parentId];\n\n  const joinedReplyEditActivity = {\n    ...parentReplyAct,\n    id: editActivity.id,\n    parent: editActParentObj,\n    editParent: editActParentObj,\n    replyParent: parentReplyAct.parent,\n    object: editActivity.object,\n    published: editActivity.published\n  };\n\n  return joinedReplyEditActivity;\n};\n"],"mappings":"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"}