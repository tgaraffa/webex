{"version":3,"names":["registerInternalPlugin","Search","config","payloadTransformer","predicates","name","direction","test","ctx","options","resolve","service","url","webex","internal","services","getServiceFromUrl","extract","body","response","then","res","activities","items","transforms","fn","object","encryption","encryptText","searchEncryptionKeyUrl","query","q"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {registerInternalPlugin} from '@webex/webex-core';\nimport {has} from 'lodash';\n\nimport Search from './search';\nimport config from './config';\n\nimport '@webex/internal-plugin-conversation';\nimport '@webex/internal-plugin-encryption';\n\nregisterInternalPlugin('search', Search, {\n  config,\n  payloadTransformer: {\n    predicates: [\n      {\n        name: 'encryptSearchQuery',\n        direction: 'outbound',\n        test(ctx, options) {\n          if (!has(options, 'body.query')) {\n            return Promise.resolve(false);\n          }\n\n          if (!has(options, 'body.searchEncryptionKeyUrl')) {\n            return Promise.resolve(false);\n          }\n\n          if (options.service === 'argonaut') {\n            return Promise.resolve(true);\n          }\n\n          if (options.url) {\n            const service = ctx.webex.internal.services.getServiceFromUrl(options.url);\n\n            return Promise.resolve(service && service.name === 'argonaut');\n          }\n\n          return Promise.resolve(false);\n        },\n        extract(options) {\n          return Promise.resolve(options.body);\n        }\n      },\n      {\n        name: 'transformObjectArray',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.activities.items[0].objectType'))\n            .then((res) => {\n              if (!res) {\n                return Promise.resolve(false);\n              }\n\n              if (response.options.service === 'argonaut') {\n                return Promise.resolve(true);\n              }\n\n              if (response.options.url) {\n                const service = ctx.webex.internal.services.getServiceFromUrl(response.options.url);\n\n                return Promise.resolve(service && service.name === 'argonaut');\n              }\n\n              return Promise.resolve(false);\n            });\n        },\n        extract(response) {\n          return Promise.resolve(response.body.activities.items);\n        }\n      }\n    ],\n    transforms: [\n      {\n        name: 'encryptSearchQuery',\n        direction: 'outbound',\n        fn(ctx, object) {\n          return ctx.webex.internal.encryption.encryptText(object.searchEncryptionKeyUrl, object.query)\n            .then((q) => {\n              object.query = q;\n            });\n        }\n      }\n    ]\n  }\n});\n\nexport {default} from './search';\n"],"mappings":"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"}