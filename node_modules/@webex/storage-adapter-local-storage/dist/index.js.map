{"version":3,"names":["namespaces","loggers","StorageAdapterLocalStorage","basekey","Bound","namespace","options","set","logger","rawData","localStorage","getItem","JSON","parse","allData","_getRawData","get","data","setItem","info","resolve","removeItem","key","_load","_save","reject","debug","value","NotFoundError","Error"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nimport {NotFoundError} from '@webex/webex-core';\n\nconst namespaces = new WeakMap();\nconst loggers = new WeakMap();\n\n/**\n * localStorage adapter for webex-core storage layer\n */\nexport default class StorageAdapterLocalStorage {\n  /**\n   * @constructs {StorageAdapterLocalStorage}\n   * @param {string} basekey localStorage key underwhich all namespaces will be\n   * stored\n   */\n  constructor(basekey) {\n    /**\n     * localStorage binding\n     */\n    this.Bound = class {\n      /**\n       * @constructs {Bound}\n       * @param {string} namespace\n       * @param {Object} options\n       */\n      constructor(namespace, options) {\n        namespaces.set(this, namespace);\n        loggers.set(this, options.logger);\n      }\n\n      /**\n       * @private\n       * @returns {rawData}\n       */\n      _getRawData() {\n        const rawData = localStorage.getItem(basekey);\n\n        return rawData ? JSON.parse(rawData) : {};\n      }\n\n      /**\n       * @private\n       * @returns {mixed}\n       */\n      _load() {\n        const allData = this._getRawData();\n\n        return allData[namespaces.get(this)] || {};\n      }\n\n      /**\n       * @param {Object} data\n       * @private\n       * @returns {undefined}\n       */\n      _save(data) {\n        const allData = this._getRawData();\n\n        allData[namespaces.get(this)] = data;\n\n        localStorage.setItem(basekey, JSON.stringify(allData));\n      }\n\n      /**\n       * Clears the localStorage\n       * @param {string} key\n       * @returns {Promise}\n       */\n      clear() {\n        loggers.get(this).info('local-storage-store-adapter: clearing localStorage');\n\n        return Promise.resolve(localStorage.removeItem(basekey));\n      }\n\n      /**\n       * Removes the specified key\n       * @param {string} key\n       * @returns {Promise}\n       */\n      del(key) {\n        return new Promise((resolve) => {\n          loggers.get(this).info(`local-storage-store-adapter: deleting \\`${key}\\``);\n          const data = this._load();\n\n          Reflect.deleteProperty(data, key);\n          this._save(data);\n          resolve();\n        });\n      }\n\n      /**\n       * Retrieves the data at the specified key\n       * @param {string} key\n       * @returns {Promise<mixed>}\n       */\n      get(key) {\n        return new Promise((resolve, reject) => {\n          loggers.get(this).debug(`local-storage-store-adapter: reading \\`${key}\\``);\n          const data = this._load();\n          const value = data[key];\n\n          if (typeof value !== 'undefined') {\n            return resolve(value);\n          }\n\n          return reject(new NotFoundError(`No value found for ${key}`));\n        });\n      }\n\n      /**\n       * Stores the specified value at the specified key\n       * @param {string} key\n       * @param {mixed} value\n       * @returns {Promise}\n       */\n      put(key, value) {\n        return new Promise((resolve) => {\n          loggers.get(this).debug(`local-storage-store-adapter: writing \\`${key}\\``);\n          const data = this._load();\n\n          data[key] = value;\n          this._save(data);\n          resolve();\n        });\n      }\n    };\n  }\n\n  /**\n   * Returns an adapter bound to the specified namespace\n   * @param {string} namespace\n   * @param {Object} options\n   * @returns {Promise<Bound>}\n   */\n  bind(namespace, options) {\n    options = options || {};\n    if (!namespace) {\n      return Promise.reject(new Error('`namespace` is required'));\n    }\n\n    if (!options.logger) {\n      return Promise.reject(new Error('`options.logger` is required'));\n    }\n\n    options.logger.debug('local-storage-store-adapter: returning binding');\n\n    return Promise.resolve(new this.Bound(namespace, options));\n  }\n}\n"],"mappings":"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"}