{"version":3,"names":["PASSWORD_ERROR_DEFAULT_MESSAGE","CAPTCHA_ERROR_DEFAULT_MESSAGE","ADHOC_MEETING_DEFAULT_ERROR","CAPTCHA_ERROR_REQUIRES_PASSWORD_CODES","MeetingInfoV2PasswordError","wbxAppApiErrorCode","meetingInfo","message","name","sdkMessage","stack","Error","wbxAppApiCode","MeetingInfoV2AdhocMeetingError","MeetingInfoV2CaptchaError","captchaInfo","isPasswordRequired","includes","MeetingInfoV2","webex","destination","type","MeetingInfoUtil","getDestinationType","conversationUrl","meetings","preferredWebexSite","getInvitees","particpants","invitees","forEach","participant","push","email","emailAddress","ciUserUuid","entryUUID","internal","conversation","get","url","includeParticipants","disableTransform","then","body","title","displayName","spaceUrl","keyUrl","encryptionKeyUrl","kroUrl","kmsResourceObjectUrl","participants","items","uri","Metrics","sendBehavioralMetric","BEHAVIORAL_METRICS","ADHOC_MEETING_SUCCESS","request","method","HTTP_VERBS","POST","catch","err","ADHOC_MEETING_FAILURE","reason","code","password","destinationType","_CONVERSATION_URL_","config","experimental","enableAdhocMeetings","createAdhocSpaceMeeting","getRequestBody","options","getDirectMeetingInfoURI","directURI","service","WBXAPPAPI_SERVICE","resource","response","FETCH_MEETING_INFO_V1_SUCCESS","statusCode","VERIFY_PASSWORD_ERROR","data","VERIFY_CAPTCHA_ERROR","captchaId","captchaID","verificationImageURL","verificationAudioURL","refreshURL","FETCH_MEETING_INFO_V1_FAILURE"],"sources":["meeting-info-v2.js"],"sourcesContent":["\nimport {HTTP_VERBS, _CONVERSATION_URL_, WBXAPPAPI_SERVICE} from '../constants';\nimport Metrics from '../metrics';\nimport BEHAVIORAL_METRICS from '../metrics/constants';\n\nimport MeetingInfoUtil from './utilv2';\n\nconst PASSWORD_ERROR_DEFAULT_MESSAGE = 'Password required. Call fetchMeetingInfo() with password argument';\nconst CAPTCHA_ERROR_DEFAULT_MESSAGE = 'Captcha required. Call fetchMeetingInfo() with captchaInfo argument';\nconst ADHOC_MEETING_DEFAULT_ERROR = 'Failed starting the adhoc meeting, Please contact support team ';\nconst CAPTCHA_ERROR_REQUIRES_PASSWORD_CODES = [423005, 423006];\n\n/**\n * Error to indicate that wbxappapi requires a password\n */\nexport class MeetingInfoV2PasswordError extends Error {\n  /**\n    *\n    * @constructor\n    * @param {Number} [wbxAppApiErrorCode]\n    * @param {Object} [meetingInfo]\n    * @param {String} [message]\n    */\n  constructor(wbxAppApiErrorCode, meetingInfo, message = PASSWORD_ERROR_DEFAULT_MESSAGE) {\n    super(`${message}, code=${wbxAppApiErrorCode}`);\n    this.name = 'MeetingInfoV2PasswordError';\n    this.sdkMessage = message;\n    this.stack = (new Error()).stack;\n    this.wbxAppApiCode = wbxAppApiErrorCode;\n    this.meetingInfo = meetingInfo;\n  }\n}\n\n/**\n * Error generating a adhoc space meeting\n */\nexport class MeetingInfoV2AdhocMeetingError extends Error {\n  /**\n    *\n    * @constructor\n    * @param {Number} [wbxAppApiErrorCode]\n    * @param {String} [message]\n    */\n  constructor(wbxAppApiErrorCode, message = ADHOC_MEETING_DEFAULT_ERROR) {\n    super(`${message}, code=${wbxAppApiErrorCode}`);\n    this.name = 'MeetingInfoV2AdhocMeetingError';\n    this.sdkMessage = message;\n    this.stack = (new Error()).stack;\n    this.wbxAppApiCode = wbxAppApiErrorCode;\n  }\n}\n\n\n/**\n   * Error to indicate that preferred webex site not present to start adhoc meeting\n   */\nexport class MeetingInfoV2CaptchaError extends Error {\n  /**\n    *\n    * @constructor\n    * @param {Number} [wbxAppApiErrorCode]\n    * @param {Object} [captchaInfo]\n    * @param {String} [message]\n    */\n  constructor(wbxAppApiErrorCode, captchaInfo, message = CAPTCHA_ERROR_DEFAULT_MESSAGE) {\n    super(`${message}, code=${wbxAppApiErrorCode}`);\n    this.name = 'MeetingInfoV2PasswordError';\n    this.sdkMessage = message;\n    this.stack = (new Error()).stack;\n    this.wbxAppApiCode = wbxAppApiErrorCode;\n    this.isPasswordRequired = CAPTCHA_ERROR_REQUIRES_PASSWORD_CODES.includes(wbxAppApiErrorCode);\n    this.captchaInfo = captchaInfo;\n  }\n}\n\n/**\n   * @class MeetingInfo\n   */\nexport default class MeetingInfoV2 {\n  /**\n     *\n     * @param {WebexSDK} webex\n     */\n  constructor(webex) {\n    this.webex = webex;\n  }\n\n  /**\n     * converts hydra id into conversation url and persons Id\n     * @param {String} destination one of many different types of destinations to look up info for\n     * @param {String} [type] to match up with the destination value\n     * @returns {Promise} destination and type\n     * @public\n     * @memberof MeetingInfo\n     */\n  fetchInfoOptions(destination, type = null) {\n    return MeetingInfoUtil.getDestinationType({\n      destination,\n      type,\n      webex: this.webex\n    });\n  }\n\n  /**\n     * Creates adhoc space meetings for a space by fetching the conversation infomation\n     * @param {String} conversationUrl conversationUrl to start adhoc meeting on\n     * @returns {Promise} returns a meeting info object\n     * @public\n     * @memberof MeetingInfo\n     */\n  async createAdhocSpaceMeeting(conversationUrl) {\n    if (!this.webex.meetings.preferredWebexSite) {\n      throw Error('No preferred webex site found');\n    }\n    const getInvitees = (particpants = []) => {\n      const invitees = [];\n\n      if (particpants) {\n        particpants.forEach((participant) => {\n          invitees.push({\n            email: participant.emailAddress,\n            ciUserUuid: participant.entryUUID\n          });\n        });\n      }\n\n      return invitees;\n    };\n\n    return this.webex.internal.conversation.get(\n      {url: conversationUrl},\n      {includeParticipants: true, disableTransform: true}\n    )\n      .then((conversation) => {\n        const body = {\n          title: conversation.displayName,\n          spaceUrl: conversation.url,\n          keyUrl: conversation.encryptionKeyUrl,\n          kroUrl: conversation.kmsResourceObjectUrl,\n          invitees: getInvitees(conversation.participants?.items)\n        };\n\n        const uri = this.webex.meetings.preferredWebexSite ?\n          `https://${this.webex.meetings.preferredWebexSite}/wbxappapi/v2/meetings/spaceInstant` : '';\n\n        Metrics.sendBehavioralMetric(\n          BEHAVIORAL_METRICS.ADHOC_MEETING_SUCCESS\n        );\n\n        return this.webex.request({\n          method: HTTP_VERBS.POST,\n          uri,\n          body\n        });\n      })\n      .catch((err) => {\n        Metrics.sendBehavioralMetric(\n          BEHAVIORAL_METRICS.ADHOC_MEETING_FAILURE,\n          {\n            reason: err.message,\n            stack: err.stack\n          }\n        );\n        throw new MeetingInfoV2AdhocMeetingError(err.body?.code, err.body?.message);\n      });\n  }\n\n  /**\n     * Fetches meeting info from the server\n     * @param {String} destination one of many different types of destinations to look up info for\n     * @param {String} [type] to match up with the destination value\n     * @param {String} password\n     * @param {Object} captchaInfo\n     * @param {String} captchaInfo.code\n     * @param {String} captchaInfo.id\n     * @returns {Promise} returns a meeting info object\n     * @public\n     * @memberof MeetingInfo\n     */\n  async fetchMeetingInfo(destination, type = null, password = null, captchaInfo = null) {\n    const destinationType = await MeetingInfoUtil.getDestinationType({\n      destination,\n      type,\n      webex: this.webex\n    });\n\n    if (destinationType.type === _CONVERSATION_URL_ && this.webex.config.meetings.experimental.enableAdhocMeetings && this.webex.meetings.preferredWebexSite) {\n      return this.createAdhocSpaceMeeting(destinationType.destination);\n    }\n\n    const body = await MeetingInfoUtil.getRequestBody({...destinationType, password, captchaInfo});\n\n    const options = {\n      method: HTTP_VERBS.POST,\n      body\n    };\n\n    const directURI = await MeetingInfoUtil.getDirectMeetingInfoURI(destinationType);\n\n    if (directURI) {\n      options.uri = directURI;\n    }\n    else {\n      options.service = WBXAPPAPI_SERVICE;\n      options.resource = 'meetingInfo';\n    }\n\n    return this.webex.request(options)\n      .then((response) => {\n        Metrics.sendBehavioralMetric(\n          BEHAVIORAL_METRICS.FETCH_MEETING_INFO_V1_SUCCESS\n        );\n\n        return response;\n      })\n      .catch((err) => {\n        if (err?.statusCode === 403) {\n          Metrics.sendBehavioralMetric(\n            BEHAVIORAL_METRICS.VERIFY_PASSWORD_ERROR,\n            {\n              reason: err.message,\n              stack: err.stack\n            }\n          );\n\n          throw new MeetingInfoV2PasswordError(err.body?.code, err.body?.data?.meetingInfo);\n        }\n        if (err?.statusCode === 423) {\n          Metrics.sendBehavioralMetric(\n            BEHAVIORAL_METRICS.VERIFY_CAPTCHA_ERROR,\n            {\n              reason: err.message,\n              stack: err.stack\n            }\n          );\n\n          throw new MeetingInfoV2CaptchaError(err.body?.code, {\n            captchaId: err.body.captchaID,\n            verificationImageURL: err.body.verificationImageURL,\n            verificationAudioURL: err.body.verificationAudioURL,\n            refreshURL: err.body.refreshURL\n          });\n        }\n\n        Metrics.sendBehavioralMetric(\n          BEHAVIORAL_METRICS.FETCH_MEETING_INFO_V1_FAILURE,\n          {\n            reason: err.message,\n            stack: err.stack\n          }\n        );\n        throw err;\n      });\n  }\n}\n"],"mappings":"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"}