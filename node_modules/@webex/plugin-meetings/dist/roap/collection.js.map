{"version":3,"names":["RoapCollection","sessions","getSession","id","activeSequences","deleteSession","getSessionSequence","seqId","session","state","RoapStateMachine","createState","finished","deleteSessionSequence","seq","isBusy","onSessionSequenceFinish"],"sources":["collection.js"],"sourcesContent":["import RoapStateMachine from '../roap/state';\n\n/* eslint-disable */\nconst RoapCollection = {\n  sessions: {},\n\n  getSession(id) {\n    if (!this.sessions[id]) {\n      this.sessions[id] = {\n        activeSequences: 0,\n      };\n    }\n    return this.sessions[id];\n  },\n\n  deleteSession(id) {\n    if (this.getSession(id)) {\n      delete this.sessions[id];\n    }\n  },\n\n  getSessionSequence(id, seqId) {\n    const session = this.getSession(id);\n    if (!session[seqId]) {\n      session[seqId] = {\n        state: RoapStateMachine.createState(),\n        finished: false,\n      };\n      session.activeSequences += 1;\n\n    }\n    return session[seqId];\n  },\n\n  deleteSessionSequence(id, seqId) {\n    const seq = this.getSessionSequence(id, seqId);\n    if (seq) {\n      if (!seq.finished) {\n        session.activeSequences -= 1;\n      }\n      delete this.sessions[id][seqId];\n    }\n  },\n\n  isBusy(id) {\n    const session = this.getSession(id);\n    if (!session) return false;\n\n    return session.activeSequences > 0;\n  },\n\n  onSessionSequenceFinish(id, seqId) {\n    const session = this.getSession(id);\n    const seq = session[seqId];\n    if (seq && !seq.finished) {\n      seq.finished = true;\n      session.activeSequences -= 1;\n    }\n  }\n\n};\n\nexport default RoapCollection;\n"],"mappings":";;;;;;;;;;;;AAAA;;AAEA;AACA,IAAMA,cAAc,GAAG;EACrBC,QAAQ,EAAE,EADW;EAGrBC,UAHqB,sBAGVC,EAHU,EAGN;IACb,IAAI,CAAC,KAAKF,QAAL,CAAcE,EAAd,CAAL,EAAwB;MACtB,KAAKF,QAAL,CAAcE,EAAd,IAAoB;QAClBC,eAAe,EAAE;MADC,CAApB;IAGD;;IACD,OAAO,KAAKH,QAAL,CAAcE,EAAd,CAAP;EACD,CAVoB;EAYrBE,aAZqB,yBAYPF,EAZO,EAYH;IAChB,IAAI,KAAKD,UAAL,CAAgBC,EAAhB,CAAJ,EAAyB;MACvB,OAAO,KAAKF,QAAL,CAAcE,EAAd,CAAP;IACD;EACF,CAhBoB;EAkBrBG,kBAlBqB,8BAkBFH,EAlBE,EAkBEI,KAlBF,EAkBS;IAC5B,IAAMC,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;;IACA,IAAI,CAACK,OAAO,CAACD,KAAD,CAAZ,EAAqB;MACnBC,OAAO,CAACD,KAAD,CAAP,GAAiB;QACfE,KAAK,EAAEC,cAAA,CAAiBC,WAAjB,EADQ;QAEfC,QAAQ,EAAE;MAFK,CAAjB;MAIAJ,OAAO,CAACJ,eAAR,IAA2B,CAA3B;IAED;;IACD,OAAOI,OAAO,CAACD,KAAD,CAAd;EACD,CA7BoB;EA+BrBM,qBA/BqB,iCA+BCV,EA/BD,EA+BKI,KA/BL,EA+BY;IAC/B,IAAMO,GAAG,GAAG,KAAKR,kBAAL,CAAwBH,EAAxB,EAA4BI,KAA5B,CAAZ;;IACA,IAAIO,GAAJ,EAAS;MACP,IAAI,CAACA,GAAG,CAACF,QAAT,EAAmB;QACjBJ,OAAO,CAACJ,eAAR,IAA2B,CAA3B;MACD;;MACD,OAAO,KAAKH,QAAL,CAAcE,EAAd,EAAkBI,KAAlB,CAAP;IACD;EACF,CAvCoB;EAyCrBQ,MAzCqB,kBAyCdZ,EAzCc,EAyCV;IACT,IAAMK,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;IACA,IAAI,CAACK,OAAL,EAAc,OAAO,KAAP;IAEd,OAAOA,OAAO,CAACJ,eAAR,GAA0B,CAAjC;EACD,CA9CoB;EAgDrBY,uBAhDqB,mCAgDGb,EAhDH,EAgDOI,KAhDP,EAgDc;IACjC,IAAMC,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;IACA,IAAMW,GAAG,GAAGN,OAAO,CAACD,KAAD,CAAnB;;IACA,IAAIO,GAAG,IAAI,CAACA,GAAG,CAACF,QAAhB,EAA0B;MACxBE,GAAG,CAACF,QAAJ,GAAe,IAAf;MACAJ,OAAO,CAACJ,eAAR,IAA2B,CAA3B;IACD;EACF;AAvDoB,CAAvB;eA2DeJ,c"}