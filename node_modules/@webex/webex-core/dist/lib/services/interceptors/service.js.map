{"version":3,"names":["trailingSlashes","ServiceInterceptor","options","uri","normalizeOptions","validateOptions","services","webex","internal","service","resource","waitForService","name","then","serviceUrl","generateUri","catch","reject","Error","formattedService","replace","formattedResource","api","Interceptor"],"sources":["service.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Interceptor} from '@webex/http-core';\n\nconst trailingSlashes = /(?:^\\/)|(?:\\/$)/;\n\n/**\n * @class\n */\nexport default class ServiceInterceptor extends Interceptor {\n  /**\n   * @returns {ServiceInterceptor}\n   */\n  static create() {\n    /* eslint no-invalid-this: [0] */\n    return new ServiceInterceptor({webex: this});\n  }\n\n  /* eslint-disable no-param-reassign */\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  onRequest(options) {\n    // Validate that the PTO includes a uri property.\n    if (options.uri) {\n      return options;\n    }\n\n    // Normalize and validate the PTO.\n    this.normalizeOptions(options);\n    this.validateOptions(options);\n\n    // Destructure commonly referenced namespaces.\n    const {services} = this.webex.internal;\n    const {service, resource} = options;\n\n    // Attempt to collect the service url.\n    return services.waitForService({name: service})\n      .then((serviceUrl) => {\n        // Generate the combined service url and resource.\n        options.uri = this.generateUri(serviceUrl, resource);\n\n        return options;\n      })\n      .catch(() => Promise.reject(new Error(\n        `service-interceptor: '${service}' is not a known service`\n      )));\n  }\n\n  /* eslint-disable class-methods-use-this */\n  /**\n   * Generate a usable request uri string from a service url and a resouce.\n   *\n   * @param {string} serviceUrl - The service url.\n   * @param {string} [resource] - The resouce to be appended to the service url.\n   * @returns {string} - The combined service url and resource.\n   */\n  generateUri(serviceUrl, resource = '') {\n    const formattedService = serviceUrl.replace(trailingSlashes, '');\n    const formattedResource = resource.replace(trailingSlashes, '');\n\n    return `${formattedService}/${formattedResource}`;\n  }\n\n  /**\n   * Normalizes request options relative to service identification.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  normalizeOptions(options) {\n    // Validate if the api property is used.\n    if (options.api) {\n      // Assign the service property the value of the api property if necessary.\n      options.service = options.service || options.api;\n      delete options.api;\n    }\n  }\n\n  /**\n   * Validates that the appropriate options for this interceptor are present.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  validateOptions(options) {\n    if (!options.resource) {\n      throw new Error('a `resource` parameter is required');\n    }\n\n    if (!options.service) {\n      throw new Error('a valid \\'service\\' parameter is required');\n    }\n  }\n  /* eslint-enable class-methods-use-this, no-param-reassign */\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;;;;;AAEA,IAAMA,eAAe,GAAG,iBAAxB;AAEA;AACA;AACA;;IACqBC,kB;;;;;;;;;;;;;IASnB;;IACA;AACF;AACA;AACA;AACA;IACE,mBAAUC,OAAV,EAAmB;MAAA;;MACjB;MACA,IAAIA,OAAO,CAACC,GAAZ,EAAiB;QACf,OAAOD,OAAP;MACD,CAJgB,CAMjB;;;MACA,KAAKE,gBAAL,CAAsBF,OAAtB;MACA,KAAKG,eAAL,CAAqBH,OAArB,EARiB,CAUjB;;MACA,IAAOI,QAAP,GAAmB,KAAKC,KAAL,CAAWC,QAA9B,CAAOF,QAAP;MACA,IAAOG,OAAP,GAA4BP,OAA5B,CAAOO,OAAP;MAAA,IAAgBC,QAAhB,GAA4BR,OAA5B,CAAgBQ,QAAhB,CAZiB,CAcjB;;MACA,OAAOJ,QAAQ,CAACK,cAAT,CAAwB;QAACC,IAAI,EAAEH;MAAP,CAAxB,EACJI,IADI,CACC,UAACC,UAAD,EAAgB;QACpB;QACAZ,OAAO,CAACC,GAAR,GAAc,KAAI,CAACY,WAAL,CAAiBD,UAAjB,EAA6BJ,QAA7B,CAAd;QAEA,OAAOR,OAAP;MACD,CANI,EAOJc,KAPI,CAOE;QAAA,OAAM,iBAAQC,MAAR,CAAe,IAAIC,KAAJ,iCACDT,OADC,8BAAf,CAAN;MAAA,CAPF,CAAP;IAUD;IAED;;IACA;AACF;AACA;AACA;AACA;AACA;AACA;;;;WACE,qBAAYK,UAAZ,EAAuC;MAAA,IAAfJ,QAAe,uEAAJ,EAAI;MACrC,IAAMS,gBAAgB,GAAGL,UAAU,CAACM,OAAX,CAAmBpB,eAAnB,EAAoC,EAApC,CAAzB;MACA,IAAMqB,iBAAiB,GAAGX,QAAQ,CAACU,OAAT,CAAiBpB,eAAjB,EAAkC,EAAlC,CAA1B;MAEA,iBAAUmB,gBAAV,cAA8BE,iBAA9B;IACD;IAED;AACF;AACA;AACA;AACA;AACA;;;;WACE,0BAAiBnB,OAAjB,EAA0B;MACxB;MACA,IAAIA,OAAO,CAACoB,GAAZ,EAAiB;QACf;QACApB,OAAO,CAACO,OAAR,GAAkBP,OAAO,CAACO,OAAR,IAAmBP,OAAO,CAACoB,GAA7C;QACA,OAAOpB,OAAO,CAACoB,GAAf;MACD;IACF;IAED;AACF;AACA;AACA;AACA;AACA;;;;WACE,yBAAgBpB,OAAhB,EAAyB;MACvB,IAAI,CAACA,OAAO,CAACQ,QAAb,EAAuB;QACrB,MAAM,IAAIQ,KAAJ,CAAU,oCAAV,CAAN;MACD;;MAED,IAAI,CAAChB,OAAO,CAACO,OAAb,EAAsB;QACpB,MAAM,IAAIS,KAAJ,CAAU,2CAAV,CAAN;MACD;IACF;IACD;;;;;IAtFA;AACF;AACA;IACE,kBAAgB;MACd;MACA,OAAO,IAAIjB,kBAAJ,CAAuB;QAACM,KAAK,EAAE;MAAR,CAAvB,CAAP;IACD;;;EAP6CgB,qB"}