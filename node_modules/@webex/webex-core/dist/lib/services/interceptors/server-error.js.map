{"version":3,"names":["ServerErrorInterceptor","options","reason","WebexHttpError","InternalServerError","BadGateway","ServiceUnavailable","uri","feature","webex","internal","device","features","developer","get","value","metrics","submitClientMetrics","fields","success","tags","action","error","message","url","resolve","services","markFailedUrl","then","reject","Interceptor"],"sources":["server-error.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Interceptor} from '@webex/http-core';\nimport {WebexHttpError} from '@webex/webex-core';\n/**\n * Changes server url when it fails\n */\nexport default class ServerErrorInterceptor extends Interceptor {\n  /**\n  * @returns {HAMessagingInterceptor}\n  */\n  static create() {\n    // eslint-disable-next-line no-invalid-this\n    return new ServerErrorInterceptor({webex: this});\n  }\n\n\n  /**\n   * @see Interceptor#onResponseError\n   * @param {Object} options\n   * @param {Object} reason\n   * @returns {Object}\n   */\n  onResponseError(options, reason) {\n    if ((reason instanceof WebexHttpError.InternalServerError || reason instanceof WebexHttpError.BadGateway || reason instanceof WebexHttpError.ServiceUnavailable) && options.uri) {\n      const feature = this.webex.internal.device.features.developer.get('web-high-availability');\n\n      if (feature && feature.value) {\n        this.webex.internal.metrics.submitClientMetrics('web-ha', {\n          fields: {success: false},\n          tags: {action: 'failed', error: reason.message, url: options.uri}\n        });\n\n        return Promise.resolve(this.webex.internal.services.markFailedUrl(options.uri))\n          .then(() => Promise.reject(reason));\n      }\n    }\n\n    return Promise.reject(reason);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;AACA;;;;;;AACA;AACA;AACA;IACqBA,sB;;;;;;;;;;;;;IAUnB;AACF;AACA;AACA;AACA;AACA;IACE,yBAAgBC,OAAhB,EAAyBC,MAAzB,EAAiC;MAC/B,IAAI,CAACA,MAAM,YAAYC,yBAAA,CAAeC,mBAAjC,IAAwDF,MAAM,YAAYC,yBAAA,CAAeE,UAAzF,IAAuGH,MAAM,YAAYC,yBAAA,CAAeG,kBAAzI,KAAgKL,OAAO,CAACM,GAA5K,EAAiL;QAC/K,IAAMC,OAAO,GAAG,KAAKC,KAAL,CAAWC,QAAX,CAAoBC,MAApB,CAA2BC,QAA3B,CAAoCC,SAApC,CAA8CC,GAA9C,CAAkD,uBAAlD,CAAhB;;QAEA,IAAIN,OAAO,IAAIA,OAAO,CAACO,KAAvB,EAA8B;UAC5B,KAAKN,KAAL,CAAWC,QAAX,CAAoBM,OAApB,CAA4BC,mBAA5B,CAAgD,QAAhD,EAA0D;YACxDC,MAAM,EAAE;cAACC,OAAO,EAAE;YAAV,CADgD;YAExDC,IAAI,EAAE;cAACC,MAAM,EAAE,QAAT;cAAmBC,KAAK,EAAEpB,MAAM,CAACqB,OAAjC;cAA0CC,GAAG,EAAEvB,OAAO,CAACM;YAAvD;UAFkD,CAA1D;UAKA,OAAO,iBAAQkB,OAAR,CAAgB,KAAKhB,KAAL,CAAWC,QAAX,CAAoBgB,QAApB,CAA6BC,aAA7B,CAA2C1B,OAAO,CAACM,GAAnD,CAAhB,EACJqB,IADI,CACC;YAAA,OAAM,iBAAQC,MAAR,CAAe3B,MAAf,CAAN;UAAA,CADD,CAAP;QAED;MACF;;MAED,OAAO,iBAAQ2B,MAAR,CAAe3B,MAAf,CAAP;IACD;;;;IA/BD;AACF;AACA;IACE,kBAAgB;MACd;MACA,OAAO,IAAIF,sBAAJ,CAA2B;QAACS,KAAK,EAAE;MAAR,CAA3B,CAAP;IACD;;;EAPiDqB,qB"}