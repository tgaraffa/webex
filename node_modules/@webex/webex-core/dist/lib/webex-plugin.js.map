{"version":3,"names":["WebexPlugin","AmpState","extend","derived","boundedStorage","deps","fn","makeWebexPluginStore","unboundedStorage","config","cache","webex","namespace","getNamespace","toLowerCase","logger","console","parent","collection","Error","session","type","ready","default","clear","options","attributes","forEach","key","unset","_children","_collections","reset","initialize","args","prototype","_dataTypes","set","bind","on","model","trigger","inspect","depth","util","serialize","props","request","upload","when","eventName","rest","length","resolve","once","_filterSetParameters","value","attrs"],"sources":["webex-plugin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\nimport AmpState from 'ampersand-state';\nimport {\n  cloneDeep,\n  isObject,\n  omit\n} from 'lodash';\n\nimport {makeWebexPluginStore} from './storage';\n\n/**\n * @class\n */\nconst WebexPlugin = AmpState.extend({\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('unbounded', this);\n      }\n    },\n    config: {\n    // figure out why caching config breaks the refresh integration test\n    // but not the refresh automation test.\n      cache: false,\n      deps: [\n        'webex',\n        'webex.config'\n      ],\n      fn() {\n        if (this.webex && this.webex.config) {\n          const namespace = this.getNamespace();\n\n          if (namespace) {\n            return this.webex.config[namespace.toLowerCase()];\n          }\n\n          return this.webex.config;\n        }\n\n        return {};\n      }\n    },\n\n    logger: {\n      deps: [\n        'webex',\n        'webex.logger'\n      ],\n      fn() {\n        return this.webex.logger || console;\n      }\n    },\n\n    webex: {\n      deps: ['parent'],\n      fn() {\n        if (!this.parent && !this.collection) {\n          throw new Error('Cannot determine `this.webex` without `this.parent` or `this.collection`. Please initialize `this` via `children` or `collection` or set `this.parent` manually');\n        }\n\n        /* eslint consistent-this: [0] */\n        let parent = this;\n\n        while (parent.parent || parent.collection) {\n          parent = parent.parent || parent.collection;\n        }\n\n        return parent;\n      }\n    }\n  },\n\n  session: {\n    parent: {\n      type: 'any'\n    },\n    /**\n     * Indicates this plugin is ready to be used. Defaults to true but can be\n     * overridden by plugins as appropriate. Used by {@link WebexCore#read}\n     * @instance\n     * @memberof WebexPlugin\n     * @type {boolean}\n     */\n    ready: {\n      default: true,\n      type: 'boolean'\n    }\n  },\n\n  /**\n   * Overrides AmpersandState#clear to make sure we never unset `parent` and\n   * recursively visits children/collections.\n   * @instance\n   * @memberof WebexPlugin\n   * @param {Object} options\n   * @returns {WebexPlugin}\n   */\n  clear(options) {\n    Object.keys(this.attributes).forEach((key) => {\n      if (key !== 'parent') {\n        this.unset(key, options);\n      }\n    });\n\n    Object.keys(this._children).forEach((key) => {\n      this[key].clear();\n    });\n\n    Object.keys(this._collections).forEach((key) => {\n      this[key].reset();\n    });\n\n    return this;\n  },\n\n  /**\n   * Initializer\n   * @private\n   * @param {Object} attrs\n   * @param {Object} options\n   * @returns {undefined}\n   */\n  initialize(...args) {\n    Reflect.apply(AmpState.prototype.initialize, this, args);\n\n    // HACK to deal with the fact that AmpersandState#dataTypes#set is a pure\n    // function.\n    this._dataTypes = cloneDeep(this._dataTypes);\n    Object.keys(this._dataTypes).forEach((key) => {\n      if (this._dataTypes[key].set) {\n        this._dataTypes[key].set = this._dataTypes[key].set.bind(this);\n      }\n    });\n    // END HACK\n\n    // Propagate change:[attribute] events from children\n    this.on('change', (model, options) => {\n      if (this.parent) {\n        this.parent.trigger(`change:${this.getNamespace().toLowerCase()}`, this.parent, this, options);\n      }\n    });\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'config', 'logger', 'webex', 'parent'), {depth});\n  },\n\n  request(...args) {\n    return this.webex.request(...args);\n  },\n\n  upload(...args) {\n    return this.webex.upload(...args);\n  },\n\n  when(eventName, ...rest) {\n    if (rest && rest.length > 0) {\n      throw new Error('#when() does not accept a callback, you must attach to its promise');\n    }\n\n    return new Promise((resolve) => {\n      this.once(eventName, (...args) => resolve(args));\n    });\n  },\n\n  /**\n   * Helper function for dealing with both forms of {@link AmpersandState#set()}\n   * @param {string} key\n   * @param {mixed} value\n   * @param {Object} options\n   * @private\n   * @returns {Array<Object, Object>}\n   */\n  _filterSetParameters(key, value, options) {\n    let attrs;\n\n    if (isObject(key) || key === null) {\n      attrs = key;\n      options = value;\n    }\n    else {\n      attrs = {};\n      attrs[key] = value;\n    }\n\n    options = options || {};\n\n    return [attrs, options];\n  }\n});\n\nexport default WebexPlugin;\n"],"mappings":"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"}