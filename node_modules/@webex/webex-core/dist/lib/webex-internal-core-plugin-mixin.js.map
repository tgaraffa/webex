{"version":3,"names":["mixinWebexInternalCorePlugins","State","config","interceptors","registerPlugin","name","constructor","options","prototype","_children","replace","proxies","Error","forEach","key","payloadTransformer","predicates","concat","transforms","onBeforeLogout","fn","push","plugin","_definition","ready","_derived","depList","def","deps","createDerivedProperty","modelProto","definition","cache","dep","_deps","get","_getDerivedProperty","set","TypeError"],"sources":["webex-internal-core-plugin-mixin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {get, has, isArray, isFunction, merge, union} from 'lodash';\n\n/**\n * Mixes a plugin system into an AmpState object (specifically, into WebexCore)\n * @param {AmpState} State\n * @param {Object} config\n * @param {Object} interceptors\n * @returns {AmpState}\n */\nexport default function mixinWebexInternalCorePlugins(State, config, interceptors) {\n  // eslint-disable-next-line complexity\n  State.registerPlugin = function registerPlugin(name, constructor, options = {}) {\n    if (State.prototype._children[name] && !options.replace) {\n      return;\n    }\n\n    State.prototype._children[name] = constructor;\n\n    if (options.proxies) {\n      throw new Error('Proxies are not currently supported for private plugins');\n    }\n\n    if (options.interceptors) {\n      Object.keys(options.interceptors).forEach((key) => {\n        interceptors[key] = options.interceptors[key];\n      });\n    }\n\n    if (options.config) {\n      merge(config, options.config);\n    }\n\n    if (has(options, 'payloadTransformer.predicates')) {\n      config.payloadTransformer.predicates = config.payloadTransformer.predicates.concat(\n        get(options, 'payloadTransformer.predicates')\n      );\n    }\n\n    if (has(options, 'payloadTransformer.transforms')) {\n      config.payloadTransformer.transforms = config.payloadTransformer.transforms.concat(\n        get(options, 'payloadTransformer.transforms')\n      );\n    }\n\n    if (options.onBeforeLogout) {\n      config.onBeforeLogout = config.onBeforeLogout || [];\n      const onBeforeLogout = isArray(options.onBeforeLogout) ? options.onBeforeLogout : [options.onBeforeLogout];\n\n      onBeforeLogout.forEach((fn) =>\n        config.onBeforeLogout.push({\n          plugin: name,\n          fn\n        }));\n    }\n\n    // Only mess with the plugin's derived properties if it's an amp-state plugin\n    if (constructor.prototype._definition && constructor.prototype._definition.ready) {\n      const {fn, depList} = State.prototype._derived.ready;\n      const def = {\n        deps: depList.concat(`${name}.ready`),\n        fn\n      };\n\n      createDerivedProperty(State.prototype, 'ready', def);\n    }\n  };\n\n  return State;\n}\n\n/**\n * Extracted from ampersand-state\n * @param {Object} modelProto\n * @param {string} name\n * @param {Object} definition\n * @private\n * @returns {undefined}\n */\nfunction createDerivedProperty(modelProto, name, definition) {\n  const def = (modelProto._derived[name] = {\n    fn: isFunction(definition) ? definition : definition.fn,\n    cache: definition.cache !== false,\n    depList: definition.deps || []\n  });\n\n  // add to our shared dependency list\n  def.depList.forEach((dep) => {\n    modelProto._deps[dep] = union(modelProto._deps[dep] || [], [name]);\n  });\n\n  // defined a top-level getter for derived names\n  Reflect.defineProperty(modelProto, name, {\n    get() {\n      return this._getDerivedProperty(name);\n    },\n    set() {\n      throw new TypeError(`\\`${name}\\` is a derived property, it can't be set directly.`);\n    }\n  });\n}\n"],"mappings":"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"}