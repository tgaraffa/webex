{"version":3,"names":["interceptors","WebexTrackingIdInterceptor","create","RequestEventInterceptor","RateLimitInterceptor","RequestLoggerInterceptor","process","env","ENABLE_NETWORK_LOGGING","ENABLE_VERBOSE_NETWORK_LOGGING","undefined","ResponseLoggerInterceptor","RequestTimingInterceptor","ServiceInterceptor","UserAgentInterceptor","WebexUserAgentInterceptor","AuthInterceptor","KmsDryErrorInterceptor","PayloadTransformerInterceptor","ConversationInterceptor","RedirectInterceptor","HttpStatusInterceptor","error","WebexHttpError","NetworkTimingInterceptor","EmbargoInterceptor","DefaultOptionsInterceptor","preInterceptors","postInterceptors","MAX_FILE_SIZE_IN_MB","WebexCore","AmpState","extend","version","children","internal","WebexInternalCore","constructor","attrs","options","credentials","supertoken","access_token","forEach","path","val","bearerValidator","trim","derived","boundedStorage","deps","fn","makeWebexStore","unboundedStorage","ready","loaded","_children","reduce","name","session","config","type","default","request","setOnce","sessionId","refresh","transform","direction","object","predicates","payloadTransformer","filter","p","ctx","webex","all","map","test","then","shouldTransform","extract","target","data","d","Boolean","promise","alias","applyNamedTransform","resolve","rest","unshift","args","transforms","tx","getWindow","window","initialize","trigger","onLoaded","stopListening","nextTick","listenToAndRun","onReady","prototype","key","listenTo","addInterceptor","ints","interceptor","push","includes","requestDefaults","json","uuid","v4","setConfig","newConfig","token","split","length","console","warn","replace","info","inspect","depth","util","serialize","props","logout","refresh_token","onBeforeLogout","reverse","plugin","catch","err","logger","clear","invalidate","authorization","measure","metrics","sendUnstructured","upload","file","reject","Error","phases","finalize","method","body","uploadProtocol","withCredentials","headers","shunt","EventEmitter","_uploadPhaseInitialize","_uploadPhaseUpload","transferEvents","_uploadPhaseFinalize","res","proxyEvents","debug","fileUploadSizeLimitInBytes","fileUploadSizeLimit","currentFileSizeInBytes","byteLength","_uploadAbortSession","_uploadApplySession","response","url","abortErrorDetails","fileUploadSizeLimitInMB","message","opts","phaseOptions","phaseKey","startsWith","substr","NODE_ENV","on","event","total","retry","mixinWebexInternalCorePlugins","mixinWebexCorePlugins","registerPlugin","registerInternalPlugin"],"sources":["webex-core.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\nimport util from 'util';\n\nimport {proxyEvents, retry, transferEvents} from '@webex/common';\nimport {HttpStatusInterceptor, defaults as requestDefaults} from '@webex/http-core';\nimport {defaultsDeep, get, isFunction, isString, last, merge, omit, set, unset} from 'lodash';\nimport AmpState from 'ampersand-state';\nimport uuid from 'uuid';\n\nimport AuthInterceptor from './interceptors/auth';\nimport NetworkTimingInterceptor from './interceptors/network-timing';\nimport PayloadTransformerInterceptor from './interceptors/payload-transformer';\nimport RedirectInterceptor from './interceptors/redirect';\nimport RequestEventInterceptor from './interceptors/request-event';\nimport RequestLoggerInterceptor from './interceptors/request-logger';\nimport RequestTimingInterceptor from './interceptors/request-timing';\nimport ResponseLoggerInterceptor from './interceptors/response-logger';\nimport WebexHttpError from './lib/webex-http-error';\nimport UserAgentInterceptor from './interceptors/user-agent';\nimport WebexTrackingIdInterceptor from './interceptors/webex-tracking-id';\nimport WebexUserAgentInterceptor from './interceptors/webex-user-agent';\nimport RateLimitInterceptor from './interceptors/rate-limit';\nimport EmbargoInterceptor from './interceptors/embargo';\nimport DefaultOptionsInterceptor from './interceptors/default-options';\nimport config from './config';\nimport {makeWebexStore} from './lib/storage';\nimport mixinWebexCorePlugins from './lib/webex-core-plugin-mixin';\nimport mixinWebexInternalCorePlugins from './lib/webex-internal-core-plugin-mixin';\nimport WebexInternalCore from './webex-internal-core';\n\n// TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\nconst interceptors = {\n  WebexTrackingIdInterceptor: WebexTrackingIdInterceptor.create,\n  RequestEventInterceptor: RequestEventInterceptor.create,\n  RateLimitInterceptor: RateLimitInterceptor.create,\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? RequestLoggerInterceptor.create : undefined,\n  ResponseLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? ResponseLoggerInterceptor.create : undefined,\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: RequestTimingInterceptor.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: UserAgentInterceptor.create,\n  WebexUserAgentInterceptor: WebexUserAgentInterceptor.create,\n  AuthInterceptor: AuthInterceptor.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: PayloadTransformerInterceptor.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: RedirectInterceptor.create,\n  HttpStatusInterceptor() {\n    return HttpStatusInterceptor.create({\n      error: WebexHttpError\n    });\n  },\n  NetworkTimingInterceptor: NetworkTimingInterceptor.create,\n  EmbargoInterceptor: EmbargoInterceptor.create,\n  DefaultOptionsInterceptor: DefaultOptionsInterceptor.create\n};\n\nconst preInterceptors = [\n  'ResponseLoggerInterceptor',\n  'RequestTimingInterceptor',\n  'RequestEventInterceptor',\n  'WebexTrackingIdInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst postInterceptors = [\n  'HttpStatusInterceptor',\n  'NetworkTimingInterceptor',\n  'EmbargoInterceptor',\n  'RequestLoggerInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst MAX_FILE_SIZE_IN_MB = 2048;\n\n/**\n * @class\n */\nconst WebexCore = AmpState.extend({\n  version: PACKAGE_VERSION,\n\n  children: {\n    internal: WebexInternalCore\n  },\n\n  constructor(attrs = {}, options) {\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    }\n    else {\n      // Reminder: order is important here\n      [\n        'credentials.authorization',\n        'authorization',\n        'credentials.supertoken.supertoken',\n        'supertoken',\n        'access_token',\n        'credentials.authorization.supertoken'\n      ].forEach((path) => {\n        const val = get(attrs, path);\n\n        if (val) {\n          unset(attrs, path);\n          set(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      [\n        'credentials',\n        'credentials.authorization'\n      ]\n        .forEach((path) => {\n          const val = get(attrs, path);\n\n          if (typeof val === 'string') {\n            unset(attrs, path);\n            set(attrs, 'credentials.supertoken', val);\n          }\n        });\n\n      if (typeof get(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        set(attrs, 'credentials.access_token', this.bearerValidator(get(attrs, 'credentials.access_token').trim()));\n\n        set(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return Reflect.apply(AmpState, this, [attrs, options]);\n  },\n\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn() {\n        return this.loaded && Object.keys(this._children).reduce((ready, name) => ready && this[name] && this[name].ready !== false, true);\n      }\n    }\n  },\n\n  session: {\n    config: {\n      type: 'object'\n    },\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh(...args) {\n    return this.credentials.refresh(...args);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform(direction, object) {\n    const predicates = this.config.payloadTransformer.predicates.filter(\n      (p) => !p.direction || p.direction === direction\n    );\n    const ctx = {\n      webex: this\n    };\n\n    return Promise.all(predicates.map((p) => p.test(ctx, object)\n      .then((shouldTransform) => {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object)\n          // eslint-disable-next-line max-nested-callbacks\n          .then((target) => ({\n            name: p.name,\n            target\n          }));\n      })))\n      .then((data) => data\n        .filter((d) => Boolean(d))\n        // eslint-disable-next-line max-nested-callbacks\n        .reduce((promise, {name, target, alias}) => promise.then(() => {\n          if (alias) {\n            return this.applyNamedTransform(direction, alias, target);\n          }\n\n          return this.applyNamedTransform(direction, name, target);\n        }), Promise.resolve()))\n      .then(() => object);\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform(direction, ctx, name, ...rest) {\n    if (isString(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: (...args) => this.applyNamedTransform(direction, ctx, ...args)\n      };\n    }\n\n    const transforms = ctx.webex.config.payloadTransformer.transforms.filter(\n      (tx) => tx.name === name && (!tx.direction || tx.direction === direction)\n    );\n\n    // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n    return transforms.reduce((promise, tx) => promise.then(() => {\n      if (tx.alias) {\n        return ctx.transform(tx.alias, ...rest);\n      }\n\n      return Promise.resolve(tx.fn(ctx, ...rest));\n    }), Promise.resolve())\n      .then(() => last(rest));\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize(attrs = {}) {\n    this.config = merge({}, config, attrs.config);\n\n\n    // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n    this.trigger('change:config');\n\n    const onLoaded = () => {\n      if (this.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('loaded');\n\n        this.stopListening(this, 'change:loaded', onLoaded);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:loaded', onLoaded);\n    });\n\n    const onReady = () => {\n      if (this.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('ready');\n\n        this.stopListening(this, 'change:ready', onReady);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:ready', onReady);\n    });\n\n    // Make nested events propagate in a consistent manner\n    Object.keys(this.constructor.prototype._children).forEach((key) => {\n      this.listenTo(this[key], 'change', (...args) => {\n        args.unshift(`change:${key}`);\n        this.trigger(...args);\n      });\n    });\n\n    const addInterceptor = (ints, key) => {\n      const interceptor = interceptors[key];\n\n      if (!isFunction(interceptor)) {\n        return ints;\n      }\n\n      ints.push(Reflect.apply(interceptor, this, []));\n\n      return ints;\n    };\n\n    let ints = [];\n\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = Object.keys(interceptors)\n      .filter((key) => !(preInterceptors.includes(key) || postInterceptors.includes(key)))\n      .reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n\n    this.request = requestDefaults({\n      json: true,\n      interceptors: ints\n    });\n\n    let sessionId = `${get(this, 'config.trackingIdPrefix', 'webex-js-sdk')}_${get(this, 'config.trackingIdBase', uuid.v4())}`;\n\n    if (get(this, 'config.trackingIdSuffix')) {\n      sessionId += `_${get(this, 'config.trackingIdSuffix')}`;\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig(newConfig = {}) {\n    this.config = merge({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn(\n        `Your access token does not have a space between 'Bearer' and the token, please add a space to it or replace it with this already fixed version:\\n\\n${token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    }\n    // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n      console.warn(\n        `Your access token has ${token.split(' ').length - 2} too many spaces, please use this format:\\n\\n${token.replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n\n      return token.replace(/\\s+/g, ' ');\n    }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {depth});\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout(options, ...rest) {\n    // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n    const token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n\n    options = Object.assign({token}, options);\n\n    // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n    return this.config.onBeforeLogout.reverse().reduce((promise, {plugin, fn}) => promise.then(() => {\n      return Promise.resolve(Reflect.apply(fn, this[plugin] || this.internal[plugin], [options, ...rest]))\n        // eslint-disable-next-line max-nested-callbacks\n        .catch((err) => {\n          this.logger.warn(`onBeforeLogout from plugin ${plugin}: failed`, err);\n        });\n    }), Promise.resolve())\n      .then(() => Promise.all([\n        this.boundedStorage.clear(),\n        this.unboundedStorage.clear()\n      ]))\n      .then(() => this.credentials.invalidate(...rest))\n      .then(() => this.authorization && this.authorization.logout && this.authorization.logout(options, ...rest))\n      .then(() => this.trigger('client:logout'));\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure(...args) {\n    if (this.metrics) {\n      return this.metrics.sendUnstructured(...args);\n    }\n\n    return Promise.resolve();\n  },\n\n  async upload(options) {\n    if (!options.file) {\n      return Promise.reject(new Error('`options.file` is required'));\n    }\n\n    options.phases = options.phases || {};\n    options.phases.initialize = options.phases.initialize || {};\n    options.phases.upload = options.phases.upload || {};\n    options.phases.finalize = options.phases.finalize || {};\n\n    defaultsDeep(options.phases.initialize, {\n      method: 'POST',\n      body: {\n        uploadProtocol: 'content-length'\n      }\n    }, omit(options, 'file', 'phases'));\n\n    defaultsDeep(options.phases.upload, {\n      method: 'PUT',\n      json: false,\n      withCredentials: false,\n      body: options.file,\n      headers: {\n        'x-trans-id': uuid.v4(),\n        authorization: undefined\n      }\n    });\n\n    defaultsDeep(options.phases.finalize, {\n      method: 'POST'\n    }, omit(options, 'file', 'phases'));\n\n    const shunt = new EventEmitter();\n\n    const promise = this._uploadPhaseInitialize(options)\n      .then(() => {\n        const p = this._uploadPhaseUpload(options);\n\n        transferEvents('progress', p, shunt);\n\n        return p;\n      })\n      .then((...args) => this._uploadPhaseFinalize(options, ...args))\n      .then((res) => ({...res.body, ...res.headers}));\n\n    proxyEvents(shunt, promise);\n\n    return promise;\n  },\n\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    this.logger.debug('client: initiating upload session');\n\n    return this.request(options.phases.initialize)\n      .then((...args) => {\n        const fileUploadSizeLimitInBytes = (args[0].body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB) * 1024 * 1024;\n        const currentFileSizeInBytes = options.file.byteLength;\n\n        if (fileUploadSizeLimitInBytes && fileUploadSizeLimitInBytes < currentFileSizeInBytes) {\n          return this._uploadAbortSession(currentFileSizeInBytes, ...args);\n        }\n\n        return this._uploadApplySession(options, ...args);\n      })\n      .then((res) => {\n        this.logger.debug('client: initiated upload session');\n\n        return res;\n      });\n  },\n\n  _uploadAbortSession(currentFileSizeInBytes, response) {\n    this.logger.debug('client: deleting uploaded file');\n\n    return this.request({\n      method: 'DELETE',\n      url: response.body.url,\n      headers: response.options.headers\n    }).then(() => {\n      this.logger.debug('client: deleting uploaded file complete');\n\n      const abortErrorDetails = {\n        currentFileSizeInBytes,\n        fileUploadSizeLimitInMB: response.body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB,\n        message: 'file-upload-size-limit-enabled'\n      };\n\n      return Promise.reject(new Error(`${JSON.stringify(abortErrorDetails)}`));\n    });\n  },\n\n  _uploadApplySession(options, res) {\n    const session = res.body;\n\n    ['upload', 'finalize'].reduce((opts, key) => {\n      opts[key] = Object.keys(opts[key]).reduce((phaseOptions, phaseKey) => {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          Reflect.deleteProperty(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n\n      return opts;\n    }, options.phases);\n  },\n\n  @retry\n  _uploadPhaseUpload(options) {\n    this.logger.debug('client: uploading file');\n\n    const promise = this.request(options.phases.upload)\n      .then((res) => {\n        this.logger.debug('client: uploaded file');\n\n        return res;\n      });\n\n    proxyEvents(options.phases.upload.upload, promise);\n\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', (event) => {\n        this.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    this.logger.debug('client: finalizing upload session');\n\n    return this.request(options.phases.finalize)\n      .then((res) => {\n        this.logger.debug('client: finalized upload session');\n\n        return res;\n      });\n  }\n});\n\nWebexCore.version = PACKAGE_VERSION;\n\nmixinWebexInternalCorePlugins(WebexInternalCore, config, interceptors);\nmixinWebexCorePlugins(WebexCore, config, interceptors);\n\nexport default WebexCore;\n\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\nexport function registerPlugin(name, constructor, options = {}) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\nexport function registerInternalPlugin(name, constructor, options) {\n  WebexInternalCore.registerPlugin(name, constructor, options);\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;AACA;;AAEA;;AACA;;AAEA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAEA;AACA;AACA;AACA,IAAMA,YAAY,GAAG;EACnBC,0BAA0B,EAAEA,wBAAA,CAA2BC,MADpC;EAEnBC,uBAAuB,EAAEA,qBAAA,CAAwBD,MAF9B;EAGnBE,oBAAoB,EAAEA,kBAAA,CAAqBF,MAHxB;;EAInB;EACAG,wBAAwB,EAAGC,OAAO,CAACC,GAAR,CAAYC,sBAAZ,IAAsCF,OAAO,CAACC,GAAR,CAAYE,8BAAnD,GAAqFJ,sBAAA,CAAyBH,MAA9G,GAAuHQ,SAL9H;EAMnBC,yBAAyB,EAAGL,OAAO,CAACC,GAAR,CAAYC,sBAAZ,IAAsCF,OAAO,CAACC,GAAR,CAAYE,8BAAnD,GAAqFE,uBAAA,CAA0BT,MAA/G,GAAwHQ,SANhI;;EAOnB;EACAE,wBAAwB,EAAEA,sBAAA,CAAyBV,MARhC;EASnBW,kBAAkB,EAAEH,SATD;EAUnBI,oBAAoB,EAAEA,kBAAA,CAAqBZ,MAVxB;EAWnBa,yBAAyB,EAAEA,uBAAA,CAA0Bb,MAXlC;EAYnBc,eAAe,EAAEA,aAAA,CAAgBd,MAZd;EAanBe,sBAAsB,EAAEP,SAbL;EAcnBQ,6BAA6B,EAAEA,2BAAA,CAA8BhB,MAd1C;EAenBiB,uBAAuB,EAAET,SAfN;EAgBnBU,mBAAmB,EAAEA,iBAAA,CAAoBlB,MAhBtB;EAiBnBmB,qBAjBmB,mCAiBK;IACtB,OAAOA,+BAAA,CAAsBnB,MAAtB,CAA6B;MAClCoB,KAAK,EAAEC;IAD2B,CAA7B,CAAP;EAGD,CArBkB;EAsBnBC,wBAAwB,EAAEA,sBAAA,CAAyBtB,MAtBhC;EAuBnBuB,kBAAkB,EAAEA,gBAAA,CAAmBvB,MAvBpB;EAwBnBwB,yBAAyB,EAAEA,uBAAA,CAA0BxB;AAxBlC,CAArB;AA2BA,IAAMyB,eAAe,GAAG,CACtB,2BADsB,EAEtB,0BAFsB,EAGtB,yBAHsB,EAItB,4BAJsB,EAKtB,sBALsB,CAAxB;AAQA,IAAMC,gBAAgB,GAAG,CACvB,uBADuB,EAEvB,0BAFuB,EAGvB,oBAHuB,EAIvB,0BAJuB,EAKvB,sBALuB,CAAzB;AAQA,IAAMC,mBAAmB,GAAG,IAA5B;AAEA;AACA;AACA;;AACA,IAAMC,SAAS,GAAGC,uBAAA,CAASC,MAAT,SAAgB;EAChCC,OAAO,UADyB;EAGhCC,QAAQ,EAAE;IACRC,QAAQ,EAAEC;EADF,CAHsB;EAOhCC,WAPgC,yBAOC;IAAA,IAArBC,KAAqB,uEAAb,EAAa;IAAA,IAATC,OAAS;;IAC/B,IAAI,OAAOD,KAAP,KAAiB,QAArB,EAA+B;MAC7BA,KAAK,GAAG;QACNE,WAAW,EAAE;UACXC,UAAU,EAAE;YACV;YACAC,YAAY,EAAEJ;UAFJ;QADD;MADP,CAAR;IAQD,CATD,MAUK;MACH;MACA,CACE,2BADF,EAEE,eAFF,EAGE,mCAHF,EAIE,YAJF,EAKE,cALF,EAME,sCANF,EAOEK,OAPF,CAOU,UAACC,IAAD,EAAU;QAClB,IAAMC,GAAG,GAAG,mBAAIP,KAAJ,EAAWM,IAAX,CAAZ;;QAEA,IAAIC,GAAJ,EAAS;UACP,qBAAMP,KAAN,EAAaM,IAAb;UACA,mBAAIN,KAAJ,EAAW,wBAAX,EAAqCO,GAArC;QACD;MACF,CAdD;MAgBA,CACE,aADF,EAEE,2BAFF,EAIGF,OAJH,CAIW,UAACC,IAAD,EAAU;QACjB,IAAMC,GAAG,GAAG,mBAAIP,KAAJ,EAAWM,IAAX,CAAZ;;QAEA,IAAI,OAAOC,GAAP,KAAe,QAAnB,EAA6B;UAC3B,qBAAMP,KAAN,EAAaM,IAAb;UACA,mBAAIN,KAAJ,EAAW,wBAAX,EAAqCO,GAArC;QACD;MACF,CAXH;;MAaA,IAAI,OAAO,mBAAIP,KAAJ,EAAW,0BAAX,CAAP,KAAkD,QAAtD,EAAgE;QAC9D;QACA,mBAAIA,KAAJ,EAAW,0BAAX,EAAuC,KAAKQ,eAAL,CAAqB,mBAAIR,KAAJ,EAAW,0BAAX,EAAuCS,IAAvC,EAArB,CAAvC;QAEA,mBAAIT,KAAJ,EAAW,wBAAX,EAAqCA,KAAK,CAACE,WAA3C;MACD;IACF;;IAED,OAAO,oBAAcT,uBAAd,EAAwB,IAAxB,EAA8B,CAACO,KAAD,EAAQC,OAAR,CAA9B,CAAP;EACD,CA1D+B;EA4DhCS,OAAO,EAAE;IACPC,cAAc,EAAE;MACdC,IAAI,EAAE,EADQ;MAEdC,EAFc,gBAET;QACH,OAAO,IAAAC,uBAAA,EAAe,SAAf,EAA0B,IAA1B,CAAP;MACD;IAJa,CADT;IAOPC,gBAAgB,EAAE;MAChBH,IAAI,EAAE,EADU;MAEhBC,EAFgB,gBAEX;QACH,OAAO,IAAAC,uBAAA,EAAe,WAAf,EAA4B,IAA5B,CAAP;MACD;IAJe,CAPX;IAaPE,KAAK,EAAE;MACLJ,IAAI,EAAE,CAAC,QAAD,EAAW,gBAAX,CADD;MAELC,EAFK,gBAEA;QAAA;;QACH,OAAO,KAAKI,MAAL,IAAe,mBAAY,KAAKC,SAAjB,EAA4BC,MAA5B,CAAmC,UAACH,KAAD,EAAQI,IAAR;UAAA,OAAiBJ,KAAK,IAAI,KAAI,CAACI,IAAD,CAAb,IAAuB,KAAI,CAACA,IAAD,CAAJ,CAAWJ,KAAX,KAAqB,KAA7D;QAAA,CAAnC,EAAuG,IAAvG,CAAtB;MACD;IAJI;EAbA,CA5DuB;EAiFhCK,OAAO,EAAE;IACPC,MAAM,EAAE;MACNC,IAAI,EAAE;IADA,CADD;;IAIP;AACJ;AACA;AACA;AACA;AACA;AACA;IACIN,MAAM,EAAE;MACNO,OAAO,EAAE,KADH;MAEND,IAAI,EAAE;IAFA,CAXD;IAePE,OAAO,EAAE;MACPC,OAAO,EAAE,IADF;MAEP;MACA;MACAH,IAAI,EAAE;IAJC,CAfF;IAqBPI,SAAS,EAAE;MACTD,OAAO,EAAE,IADA;MAETH,IAAI,EAAE;IAFG;EArBJ,CAjFuB;;EA4GhC;AACF;AACA;AACA;AACA;AACA;EACEK,OAlHgC,qBAkHf;IAAA;;IACf,OAAO,0BAAK1B,WAAL,EAAiB0B,OAAjB,oCAAP;EACD,CApH+B;;EAsHhC;AACF;AACA;AACA;AACA;AACA;EACEC,SA5HgC,qBA4HtBC,SA5HsB,EA4HXC,MA5HW,EA4HH;IAAA;;IAC3B,IAAMC,UAAU,GAAG,KAAKV,MAAL,CAAYW,kBAAZ,CAA+BD,UAA/B,CAA0CE,MAA1C,CACjB,UAACC,CAAD;MAAA,OAAO,CAACA,CAAC,CAACL,SAAH,IAAgBK,CAAC,CAACL,SAAF,KAAgBA,SAAvC;IAAA,CADiB,CAAnB;IAGA,IAAMM,GAAG,GAAG;MACVC,KAAK,EAAE;IADG,CAAZ;IAIA,OAAO,iBAAQC,GAAR,CAAYN,UAAU,CAACO,GAAX,CAAe,UAACJ,CAAD;MAAA,OAAOA,CAAC,CAACK,IAAF,CAAOJ,GAAP,EAAYL,MAAZ,EACtCU,IADsC,CACjC,UAACC,eAAD,EAAqB;QACzB,IAAI,CAACA,eAAL,EAAsB;UACpB,OAAOtE,SAAP;QACD;;QAED,OAAO+D,CAAC,CAACQ,OAAF,CAAUZ,MAAV,EACL;QADK,CAEJU,IAFI,CAEC,UAACG,MAAD;UAAA,OAAa;YACjBxB,IAAI,EAAEe,CAAC,CAACf,IADS;YAEjBwB,MAAM,EAANA;UAFiB,CAAb;QAAA,CAFD,CAAP;MAMD,CAZsC,CAAP;IAAA,CAAf,CAAZ,EAaJH,IAbI,CAaC,UAACI,IAAD;MAAA,OAAUA,IAAI,CACjBX,MADa,CACN,UAACY,CAAD;QAAA,OAAOC,OAAO,CAACD,CAAD,CAAd;MAAA,CADM,EAEd;MAFc,CAGb3B,MAHa,CAGN,UAAC6B,OAAD;QAAA,IAAW5B,IAAX,QAAWA,IAAX;QAAA,IAAiBwB,MAAjB,QAAiBA,MAAjB;QAAA,IAAyBK,KAAzB,QAAyBA,KAAzB;QAAA,OAAoCD,OAAO,CAACP,IAAR,CAAa,YAAM;UAC7D,IAAIQ,KAAJ,EAAW;YACT,OAAO,MAAI,CAACC,mBAAL,CAAyBpB,SAAzB,EAAoCmB,KAApC,EAA2CL,MAA3C,CAAP;UACD;;UAED,OAAO,MAAI,CAACM,mBAAL,CAAyBpB,SAAzB,EAAoCV,IAApC,EAA0CwB,MAA1C,CAAP;QACD,CAN2C,CAApC;MAAA,CAHM,EASV,iBAAQO,OAAR,EATU,CAAV;IAAA,CAbD,EAuBJV,IAvBI,CAuBC;MAAA,OAAMV,MAAN;IAAA,CAvBD,CAAP;EAwBD,CA5J+B;;EA8JhC;AACF;AACA;AACA;AACA;AACA;AACA;EACEmB,mBArKgC,+BAqKZpB,SArKY,EAqKDM,GArKC,EAqKIhB,IArKJ,EAqKmB;IAAA;;IAAA,kCAANgC,IAAM;MAANA,IAAM;IAAA;;IACjD,IAAI,wBAAShB,GAAT,CAAJ,EAAmB;MACjBgB,IAAI,CAACC,OAAL,CAAajC,IAAb;MACAA,IAAI,GAAGgB,GAAP;MACAA,GAAG,GAAG;QACJC,KAAK,EAAE,IADH;QAEJR,SAAS,EAAE;UAAA,mCAAIyB,IAAJ;YAAIA,IAAJ;UAAA;;UAAA,OAAa,MAAI,CAACJ,mBAAL,aAAI,GAAqBpB,SAArB,EAAgCM,GAAhC,SAAwCkB,IAAxC,EAAjB;QAAA;MAFP,CAAN;IAID;;IAED,IAAMC,UAAU,GAAGnB,GAAG,CAACC,KAAJ,CAAUf,MAAV,CAAiBW,kBAAjB,CAAoCsB,UAApC,CAA+CrB,MAA/C,CACjB,UAACsB,EAAD;MAAA,OAAQA,EAAE,CAACpC,IAAH,KAAYA,IAAZ,KAAqB,CAACoC,EAAE,CAAC1B,SAAJ,IAAiB0B,EAAE,CAAC1B,SAAH,KAAiBA,SAAvD,CAAR;IAAA,CADiB,CAAnB,CAViD,CAcjD;IACA;;IACA,OAAOyB,UAAU,CAACpC,MAAX,CAAkB,UAAC6B,OAAD,EAAUQ,EAAV;MAAA,OAAiBR,OAAO,CAACP,IAAR,CAAa,YAAM;QAC3D,IAAIe,EAAE,CAACP,KAAP,EAAc;UAAA;;UACZ,OAAO,QAAAb,GAAG,EAACP,SAAJ,cAAc2B,EAAE,CAACP,KAAjB,SAA2BG,IAA3B,EAAP;QACD;;QAED,OAAO,iBAAQD,OAAR,CAAgBK,EAAE,CAAC3C,EAAH,OAAA2C,EAAE,GAAIpB,GAAJ,SAAYgB,IAAZ,EAAlB,CAAP;MACD,CANyC,CAAjB;IAAA,CAAlB,EAMH,iBAAQD,OAAR,EANG,EAOJV,IAPI,CAOC;MAAA,OAAM,oBAAKW,IAAL,CAAN;IAAA,CAPD,CAAP;EAQD,CA7L+B;;EA+LhC;AACF;AACA;AACA;EACEK,SAnMgC,uBAmMpB;IACV;IACA,OAAOC,MAAP;EACD,CAtM+B;;EAwMhC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,UAlNgC,wBAkNT;IAAA;;IAAA,IAAZ3D,KAAY,uEAAJ,EAAI;IACrB,KAAKsB,MAAL,GAAc,qBAAM,EAAN,EAAUA,eAAV,EAAkBtB,KAAK,CAACsB,MAAxB,CAAd,CADqB,CAIrB;IACA;IACA;IACA;IACA;;IACA,KAAKsC,OAAL,CAAa,eAAb;;IAEA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,GAAM;MACrB,IAAI,MAAI,CAAC5C,MAAT,EAAiB;QACf;AACR;AACA;AACA;AACA;AACA;QACQ,MAAI,CAAC2C,OAAL,CAAa,QAAb;;QAEA,MAAI,CAACE,aAAL,CAAmB,MAAnB,EAAyB,eAAzB,EAA0CD,QAA1C;MACD;IACF,CAZD,CAXqB,CAyBrB;;;IACA7F,OAAO,CAAC+F,QAAR,CAAiB,YAAM;MACrB,MAAI,CAACC,cAAL,CAAoB,MAApB,EAA0B,eAA1B,EAA2CH,QAA3C;IACD,CAFD;;IAIA,IAAMI,OAAO,GAAG,SAAVA,OAAU,GAAM;MACpB,IAAI,MAAI,CAACjD,KAAT,EAAgB;QACd;AACR;AACA;AACA;AACA;AACA;QACQ,MAAI,CAAC4C,OAAL,CAAa,OAAb;;QAEA,MAAI,CAACE,aAAL,CAAmB,MAAnB,EAAyB,cAAzB,EAAyCG,OAAzC;MACD;IACF,CAZD,CA9BqB,CA4CrB;;;IACAjG,OAAO,CAAC+F,QAAR,CAAiB,YAAM;MACrB,MAAI,CAACC,cAAL,CAAoB,MAApB,EAA0B,cAA1B,EAA0CC,OAA1C;IACD,CAFD,EA7CqB,CAiDrB;;IACA,mBAAY,KAAKlE,WAAL,CAAiBmE,SAAjB,CAA2BhD,SAAvC,EAAkDb,OAAlD,CAA0D,UAAC8D,GAAD,EAAS;MACjE,MAAI,CAACC,QAAL,CAAc,MAAI,CAACD,GAAD,CAAlB,EAAyB,QAAzB,EAAmC,YAAa;QAAA,mCAATb,IAAS;UAATA,IAAS;QAAA;;QAC9CA,IAAI,CAACD,OAAL,kBAAuBc,GAAvB;;QACA,MAAI,CAACP,OAAL,aAAI,EAAYN,IAAZ,CAAJ;MACD,CAHD;IAID,CALD;;IAOA,IAAMe,cAAc,GAAG,SAAjBA,cAAiB,CAACC,IAAD,EAAOH,GAAP,EAAe;MACpC,IAAMI,WAAW,GAAG7G,YAAY,CAACyG,GAAD,CAAhC;;MAEA,IAAI,CAAC,0BAAWI,WAAX,CAAL,EAA8B;QAC5B,OAAOD,IAAP;MACD;;MAEDA,IAAI,CAACE,IAAL,CAAU,oBAAcD,WAAd,EAA2B,MAA3B,EAAiC,EAAjC,CAAV;MAEA,OAAOD,IAAP;IACD,CAVD;;IAYA,IAAIA,IAAI,GAAG,EAAX;IAEAA,IAAI,GAAGjF,eAAe,CAAC8B,MAAhB,CAAuBkD,cAAvB,EAAuCC,IAAvC,CAAP;IACAA,IAAI,GAAG,mBAAY5G,YAAZ,EACJwE,MADI,CACG,UAACiC,GAAD;MAAA,OAAS,EAAE9E,eAAe,CAACoF,QAAhB,CAAyBN,GAAzB,KAAiC7E,gBAAgB,CAACmF,QAAjB,CAA0BN,GAA1B,CAAnC,CAAT;IAAA,CADH,EAEJhD,MAFI,CAEGkD,cAFH,EAEmBC,IAFnB,CAAP;IAGAA,IAAI,GAAGhF,gBAAgB,CAAC6B,MAAjB,CAAwBkD,cAAxB,EAAwCC,IAAxC,CAAP;IAEA,KAAK7C,OAAL,GAAe,IAAAiD,kBAAA,EAAgB;MAC7BC,IAAI,EAAE,IADuB;MAE7BjH,YAAY,EAAE4G;IAFe,CAAhB,CAAf;IAKA,IAAI3C,SAAS,aAAM,mBAAI,IAAJ,EAAU,yBAAV,EAAqC,cAArC,CAAN,cAA8D,mBAAI,IAAJ,EAAU,uBAAV,EAAmCiD,aAAA,CAAKC,EAAL,EAAnC,CAA9D,CAAb;;IAEA,IAAI,mBAAI,IAAJ,EAAU,yBAAV,CAAJ,EAA0C;MACxClD,SAAS,eAAQ,mBAAI,IAAJ,EAAU,yBAAV,CAAR,CAAT;IACD;;IAED,KAAKA,SAAL,GAAiBA,SAAjB;EACD,CA3S+B;;EA6ShC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEmD,SAvTgC,uBAuTN;IAAA,IAAhBC,SAAgB,uEAAJ,EAAI;IACxB,KAAKzD,MAAL,GAAc,qBAAM,EAAN,EAAU,KAAKA,MAAf,EAAuByD,SAAvB,CAAd;EACD,CAzT+B;;EA2ThC;AACF;AACA;AACA;AACA;AACA;AACA;EACEvE,eAlUgC,2BAkUhBwE,KAlUgB,EAkUT;IACrB,IAAIA,KAAK,CAACP,QAAN,CAAe,QAAf,KAA4BO,KAAK,CAACC,KAAN,CAAY,GAAZ,EAAiBC,MAAjB,GAA0B,CAA1B,KAAgC,CAAhE,EAAmE;MACjEC,OAAO,CAACC,IAAR,8JACwJJ,KAAK,CAACK,OAAN,CAAc,QAAd,EAAwB,SAAxB,EAAmCA,OAAnC,CAA2C,MAA3C,EAAmD,GAAnD,CADxJ;MAGAF,OAAO,CAACG,IAAR,CAAa,4FAAb;MAEA,OAAON,KAAK,CAACK,OAAN,CAAc,QAAd,EAAwB,SAAxB,EAAmCA,OAAnC,CAA2C,MAA3C,EAAmD,GAAnD,CAAP;IACD,CAPD,CAQA;IACA;IATA,KAUK,IAAIL,KAAK,CAACC,KAAN,CAAY,GAAZ,EAAiBC,MAAjB,GAA0B,CAA1B,GAA8B,CAAlC,EAAqC;MACxCC,OAAO,CAACC,IAAR,iCAC2BJ,KAAK,CAACC,KAAN,CAAY,GAAZ,EAAiBC,MAAjB,GAA0B,CADrD,0DACsGF,KAAK,CAACK,OAAN,CAAc,MAAd,EAAsB,GAAtB,CADtG;MAGAF,OAAO,CAACG,IAAR,CAAa,4FAAb;MAEA,OAAON,KAAK,CAACK,OAAN,CAAc,MAAd,EAAsB,GAAtB,CAAP;IACD;;IAED,OAAOL,KAAK,CAACK,OAAN,CAAc,MAAd,EAAsB,GAAtB,CAAP,CApBqB,CAoBc;EACpC,CAvV+B;;EAyVhC;AACF;AACA;AACA;AACA;AACA;AACA;EACEE,OAhWgC,mBAgWxBC,KAhWwB,EAgWjB;IACb,OAAOC,aAAA,CAAKF,OAAL,CAAa,oBAAK,KAAKG,SAAL,CAAe;MACtCC,KAAK,EAAE,IAD+B;MAEtCtE,OAAO,EAAE,IAF6B;MAGtCX,OAAO,EAAE;IAH6B,CAAf,CAAL,EAIhB,gBAJgB,EAIE,kBAJF,EAIsB,SAJtB,EAIiC,QAJjC,CAAb,EAIyD;MAAC8E,KAAK,EAALA;IAAD,CAJzD,CAAP;EAKD,CAtW+B;;EAwWhC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEI,MArXgC,kBAqXzB3F,OArXyB,EAqXP;IAAA;;IAAA,mCAANmD,IAAM;MAANA,IAAM;IAAA;;IACvB;IACA;IACA,IAAM4B,KAAK,GAAG,KAAK9E,WAAL,CAAiBC,UAAjB,KAAgC,KAAKD,WAAL,CAAiBC,UAAjB,CAA4B0F,aAA5B,IAA6C,KAAK3F,WAAL,CAAiBC,UAAjB,CAA4BC,YAAzG,CAAd;IAEAH,OAAO,GAAG,qBAAc;MAAC+E,KAAK,EAALA;IAAD,CAAd,EAAuB/E,OAAvB,CAAV,CALuB,CAOvB;IACA;IACA;IACA;;IACA,OAAO,KAAKqB,MAAL,CAAYwE,cAAZ,CAA2BC,OAA3B,GAAqC5E,MAArC,CAA4C,UAAC6B,OAAD;MAAA,IAAWgD,MAAX,SAAWA,MAAX;MAAA,IAAmBnF,EAAnB,SAAmBA,EAAnB;MAAA,OAA2BmC,OAAO,CAACP,IAAR,CAAa,YAAM;QAC/F,OAAO,iBAAQU,OAAR,CAAgB,oBAActC,EAAd,EAAkB,MAAI,CAACmF,MAAD,CAAJ,IAAgB,MAAI,CAACnG,QAAL,CAAcmG,MAAd,CAAlC,GAA0D/F,OAA1D,SAAsEmD,IAAtE,EAAhB,EACL;QADK,CAEJ6C,KAFI,CAEE,UAACC,GAAD,EAAS;UACd,MAAI,CAACC,MAAL,CAAYf,IAAZ,sCAA+CY,MAA/C,eAAiEE,GAAjE;QACD,CAJI,CAAP;MAKD,CAN6E,CAA3B;IAAA,CAA5C,EAMH,iBAAQ/C,OAAR,EANG,EAOJV,IAPI,CAOC;MAAA,OAAM,iBAAQH,GAAR,CAAY,CACtB,MAAI,CAAC3B,cAAL,CAAoByF,KAApB,EADsB,EAEtB,MAAI,CAACrF,gBAAL,CAAsBqF,KAAtB,EAFsB,CAAZ,CAAN;IAAA,CAPD,EAWJ3D,IAXI,CAWC;MAAA;;MAAA,OAAM,4BAAI,CAACvC,WAAL,EAAiBmG,UAAjB,2BAA+BjD,IAA/B,CAAN;IAAA,CAXD,EAYJX,IAZI,CAYC;MAAA;;MAAA,OAAM,MAAI,CAAC6D,aAAL,IAAsB,MAAI,CAACA,aAAL,CAAmBV,MAAzC,IAAmD,8BAAI,CAACU,aAAL,EAAmBV,MAAnB,8BAA0B3F,OAA1B,SAAsCmD,IAAtC,EAAzD;IAAA,CAZD,EAaJX,IAbI,CAaC;MAAA,OAAM,MAAI,CAACmB,OAAL,CAAa,eAAb,CAAN;IAAA,CAbD,CAAP;EAcD,CA9Y+B;;EAgZhC;AACF;AACA;AACA;AACA;AACA;AACA;EACE2C,OAvZgC,qBAuZf;IACf,IAAI,KAAKC,OAAT,EAAkB;MAAA;;MAChB,OAAO,sBAAKA,OAAL,EAAaC,gBAAb,gCAAP;IACD;;IAED,OAAO,iBAAQtD,OAAR,EAAP;EACD,CA7Z+B;EA+Z1BuD,MA/Z0B,kBA+ZnBzG,OA/ZmB,EA+ZV;IAAA;;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,IACfA,OAAO,CAAC0G,IADO;gBAAA;gBAAA;cAAA;;cAAA,iCAEX,iBAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAU,4BAAV,CAAf,CAFW;;YAAA;cAKpB5G,OAAO,CAAC6G,MAAR,GAAiB7G,OAAO,CAAC6G,MAAR,IAAkB,EAAnC;cACA7G,OAAO,CAAC6G,MAAR,CAAenD,UAAf,GAA4B1D,OAAO,CAAC6G,MAAR,CAAenD,UAAf,IAA6B,EAAzD;cACA1D,OAAO,CAAC6G,MAAR,CAAeJ,MAAf,GAAwBzG,OAAO,CAAC6G,MAAR,CAAeJ,MAAf,IAAyB,EAAjD;cACAzG,OAAO,CAAC6G,MAAR,CAAeC,QAAf,GAA0B9G,OAAO,CAAC6G,MAAR,CAAeC,QAAf,IAA2B,EAArD;cAEA,4BAAa9G,OAAO,CAAC6G,MAAR,CAAenD,UAA5B,EAAwC;gBACtCqD,MAAM,EAAE,MAD8B;gBAEtCC,IAAI,EAAE;kBACJC,cAAc,EAAE;gBADZ;cAFgC,CAAxC,EAKG,oBAAKjH,OAAL,EAAc,MAAd,EAAsB,QAAtB,CALH;cAOA,4BAAaA,OAAO,CAAC6G,MAAR,CAAeJ,MAA5B,EAAoC;gBAClCM,MAAM,EAAE,KAD0B;gBAElCrC,IAAI,EAAE,KAF4B;gBAGlCwC,eAAe,EAAE,KAHiB;gBAIlCF,IAAI,EAAEhH,OAAO,CAAC0G,IAJoB;gBAKlCS,OAAO,EAAE;kBACP,cAAcxC,aAAA,CAAKC,EAAL,EADP;kBAEPyB,aAAa,EAAElI;gBAFR;cALyB,CAApC;cAWA,4BAAa6B,OAAO,CAAC6G,MAAR,CAAeC,QAA5B,EAAsC;gBACpCC,MAAM,EAAE;cAD4B,CAAtC,EAEG,oBAAK/G,OAAL,EAAc,MAAd,EAAsB,QAAtB,CAFH;cAIMoH,KAhCc,GAgCN,IAAIC,oBAAJ,EAhCM;cAkCdtE,OAlCc,GAkCJ,MAAI,CAACuE,sBAAL,CAA4BtH,OAA5B,EACbwC,IADa,CACR,YAAM;gBACV,IAAMN,CAAC,GAAG,MAAI,CAACqF,kBAAL,CAAwBvH,OAAxB,CAAV;;gBAEA,IAAAwH,sBAAA,EAAe,UAAf,EAA2BtF,CAA3B,EAA8BkF,KAA9B;gBAEA,OAAOlF,CAAP;cACD,CAPa,EAQbM,IARa,CAQR;gBAAA,mCAAIa,IAAJ;kBAAIA,IAAJ;gBAAA;;gBAAA,OAAa,MAAI,CAACoE,oBAAL,aAAI,GAAsBzH,OAAtB,SAAkCqD,IAAlC,EAAjB;cAAA,CARQ,EASbb,IATa,CASR,UAACkF,GAAD;gBAAA,uCAAcA,GAAG,CAACV,IAAlB,GAA2BU,GAAG,CAACP,OAA/B;cAAA,CATQ,CAlCI;cA6CpB,IAAAQ,mBAAA,EAAYP,KAAZ,EAAmBrE,OAAnB;cA7CoB,iCA+CbA,OA/Ca;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAgDrB,CA/c+B;EAidhCuE,sBAAsB,EAAE,SAASA,sBAAT,CAAgCtH,OAAhC,EAAyC;IAAA;;IAC/D,KAAKkG,MAAL,CAAY0B,KAAZ,CAAkB,mCAAlB;IAEA,OAAO,KAAKpG,OAAL,CAAaxB,OAAO,CAAC6G,MAAR,CAAenD,UAA5B,EACJlB,IADI,CACC,YAAa;MAAA,mCAATa,IAAS;QAATA,IAAS;MAAA;;MACjB,IAAMwE,0BAA0B,GAAG,CAACxE,IAAI,CAAC,CAAD,CAAJ,CAAQ2D,IAAR,CAAac,mBAAb,IAAoCxI,mBAArC,IAA4D,IAA5D,GAAmE,IAAtG;MACA,IAAMyI,sBAAsB,GAAG/H,OAAO,CAAC0G,IAAR,CAAasB,UAA5C;;MAEA,IAAIH,0BAA0B,IAAIA,0BAA0B,GAAGE,sBAA/D,EAAuF;QACrF,OAAO,MAAI,CAACE,mBAAL,aAAI,GAAqBF,sBAArB,SAAgD1E,IAAhD,EAAX;MACD;;MAED,OAAO,MAAI,CAAC6E,mBAAL,aAAI,GAAqBlI,OAArB,SAAiCqD,IAAjC,EAAX;IACD,CAVI,EAWJb,IAXI,CAWC,UAACkF,GAAD,EAAS;MACb,MAAI,CAACxB,MAAL,CAAY0B,KAAZ,CAAkB,kCAAlB;;MAEA,OAAOF,GAAP;IACD,CAfI,CAAP;EAgBD,CApe+B;EAsehCO,mBAtegC,+BAseZF,sBAteY,EAseYI,QAteZ,EAsesB;IAAA;;IACpD,KAAKjC,MAAL,CAAY0B,KAAZ,CAAkB,gCAAlB;IAEA,OAAO,KAAKpG,OAAL,CAAa;MAClBuF,MAAM,EAAE,QADU;MAElBqB,GAAG,EAAED,QAAQ,CAACnB,IAAT,CAAcoB,GAFD;MAGlBjB,OAAO,EAAEgB,QAAQ,CAACnI,OAAT,CAAiBmH;IAHR,CAAb,EAIJ3E,IAJI,CAIC,YAAM;MACZ,MAAI,CAAC0D,MAAL,CAAY0B,KAAZ,CAAkB,yCAAlB;;MAEA,IAAMS,iBAAiB,GAAG;QACxBN,sBAAsB,EAAtBA,sBADwB;QAExBO,uBAAuB,EAAEH,QAAQ,CAACnB,IAAT,CAAcc,mBAAd,IAAqCxI,mBAFtC;QAGxBiJ,OAAO,EAAE;MAHe,CAA1B;MAMA,OAAO,iBAAQ5B,MAAR,CAAe,IAAIC,KAAJ,WAAa,wBAAeyB,iBAAf,CAAb,EAAf,CAAP;IACD,CAdM,CAAP;EAeD,CAxf+B;EA0fhCH,mBA1fgC,+BA0fZlI,OA1fY,EA0fH0H,GA1fG,EA0fE;IAChC,IAAMtG,OAAO,GAAGsG,GAAG,CAACV,IAApB;IAEA,CAAC,QAAD,EAAW,UAAX,EAAuB9F,MAAvB,CAA8B,UAACsH,IAAD,EAAOtE,GAAP,EAAe;MAC3CsE,IAAI,CAACtE,GAAD,CAAJ,GAAY,mBAAYsE,IAAI,CAACtE,GAAD,CAAhB,EAAuBhD,MAAvB,CAA8B,UAACuH,YAAD,EAAeC,QAAf,EAA4B;QACpE,IAAIA,QAAQ,CAACC,UAAT,CAAoB,GAApB,CAAJ,EAA8B;UAC5BF,YAAY,CAACC,QAAQ,CAACE,MAAT,CAAgB,CAAhB,CAAD,CAAZ,GAAmCH,YAAY,CAACC,QAAD,CAAZ,CAAuBtH,OAAvB,CAAnC;UACA,6BAAuBqH,YAAvB,EAAqCC,QAArC;QACD;;QAED,OAAOD,YAAP;MACD,CAPW,EAOTD,IAAI,CAACtE,GAAD,CAPK,CAAZ;MASA,OAAOsE,IAAP;IACD,CAXD,EAWGxI,OAAO,CAAC6G,MAXX;EAYD,CAzgB+B;EA4gBhCU,kBA5gBgC,8BA4gBbvH,OA5gBa,EA4gBJ;IAAA;;IAC1B,KAAKkG,MAAL,CAAY0B,KAAZ,CAAkB,wBAAlB;IAEA,IAAM7E,OAAO,GAAG,KAAKvB,OAAL,CAAaxB,OAAO,CAAC6G,MAAR,CAAeJ,MAA5B,EACbjE,IADa,CACR,UAACkF,GAAD,EAAS;MACb,MAAI,CAACxB,MAAL,CAAY0B,KAAZ,CAAkB,uBAAlB;;MAEA,OAAOF,GAAP;IACD,CALa,CAAhB;IAOA,IAAAC,mBAAA,EAAY3H,OAAO,CAAC6G,MAAR,CAAeJ,MAAf,CAAsBA,MAAlC,EAA0C1D,OAA1C;IAEA;;IACA,IAAIhF,OAAO,CAACC,GAAR,CAAY6K,QAAZ,KAAyB,MAA7B,EAAqC;MACnC9F,OAAO,CAAC+F,EAAR,CAAW,UAAX,EAAuB,UAACC,KAAD,EAAW;QAChC,MAAI,CAAC7C,MAAL,CAAYb,IAAZ,CAAiB,iBAAjB,EAAoC0D,KAAK,CAAC/H,MAA1C,EAAkD+H,KAAK,CAACC,KAAxD;MACD,CAFD;IAGD;;IAED,OAAOjG,OAAP;EACD,CAhiB+B;EAkiBhC0E,oBAAoB,EAAE,SAASA,oBAAT,CAA8BzH,OAA9B,EAAuC;IAAA;;IAC3D,KAAKkG,MAAL,CAAY0B,KAAZ,CAAkB,mCAAlB;IAEA,OAAO,KAAKpG,OAAL,CAAaxB,OAAO,CAAC6G,MAAR,CAAeC,QAA5B,EACJtE,IADI,CACC,UAACkF,GAAD,EAAS;MACb,OAAI,CAACxB,MAAL,CAAY0B,KAAZ,CAAkB,kCAAlB;;MAEA,OAAOF,GAAP;IACD,CALI,CAAP;EAMD;AA3iB+B,CAAhB,wEA2gBfuB,aA3gBe,qFAAlB;;AA8iBA1J,SAAS,CAACG,OAAV;AAEA,IAAAwJ,qCAAA,EAA8BrJ,0BAA9B,EAAiDwB,eAAjD,EAAyD5D,YAAzD;AACA,IAAA0L,6BAAA,EAAsB5J,SAAtB,EAAiC8B,eAAjC,EAAyC5D,YAAzC;eAEe8B,S;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACO,SAAS6J,cAAT,CAAwBjI,IAAxB,EAA8BrB,WAA9B,EAAyD;EAAA,IAAdE,OAAc,uEAAJ,EAAI;EAC9DT,SAAS,CAAC6J,cAAV,CAAyBjI,IAAzB,EAA+BrB,WAA/B,EAA4CE,OAA5C;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASqJ,sBAAT,CAAgClI,IAAhC,EAAsCrB,WAAtC,EAAmDE,OAAnD,EAA4D;EACjEH,0BAAA,CAAkBuJ,cAAlB,CAAiCjI,IAAjC,EAAuCrB,WAAvC,EAAoDE,OAApD;AACD"}